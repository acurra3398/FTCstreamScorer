import{j as e,t as d,r as C,c as $e}from"./client-BvsFx6Uv.js";import{i as Re,u as ne,a as ie,b as he,c as je,d as _e,e as Pe,R as oe}from"./react-svg.esm-Sr47L1-2.js";import{r as q,a as Ue,i as ce,t as He}from"./utils-CzBzcnQn.js";import{F as P}from"./Form-C93KviTp.js";import{B as X}from"./Button-CplEHJLM.js";import{M as K}from"./Modal-BSxbHkAp.js";import{R as Ge,f as be,u as Ve,C as ze,A as Je,c as We,a as Ye,s as Ke,b as Ze,r as qe,p as Qe,d as Xe}from"./ActionButtons-CpPtNB5U.js";import{H as re,T as S,A as me,b as Y}from"./javaTypes-BFjjeUw7.js";import{M as fe}from"./javaTypes-DNGMEgAs.js";import{c as Me,m as es}from"./dialogs-Cji8mkGY.js";import{u as ae}from"./utils-CzqY5F7f.js";import{C as pe}from"./Counter-BLupmQGT.js";import{A as de,r as M,d as ss}from"./util-u-8ucP1B.js";import{E as De}from"./LocalErrorBoundary-B_5iy1c-.js";import{A as rs}from"./Alert-DR6HmQEy.js";import{T as ts}from"./Tabs-D9VHQFLB.js";import{T as ee}from"./isEqual-DTKQseSG.js";import"./index-CsyH6pUe.js";import"./tslib.es6-C3SfwpKo.js";import"./all-crwlzFAZ.js";import"./warning-PI8mi4Hb.js";import"./createWithBsPrefix-Bt6Ige_C.js";import"./SafeAnchor-G5C8N4yQ.js";import"./querySelectorAll-CV_V5nX6.js";import"./lodash-DEhfaarB.js";import"./useQuery-BagP8Nrl.js";import"./react-select.esm-DKMMOdrD.js";import"./assertThisInitialized-DpDF5Qa-.js";import"./index-DBycPXkv.js";import"./hook-ByTrhTT2.js";import"./CardContext-C2IdBV6N.js";import"./isRequiredForA11y-D3y9EsJd.js";import"./exports-gx3CWV9A.js";import"./usePopperMarginModifiers-OKrDsYDV.js";import"./ButtonGroup-BIeDoSyl.js";import"./merge-BCxs0UCa.js";import"./ElementChildren-DccXaKZk.js";import"./_baseIsEqual-BE-Qrqfl.js";try{let s=typeof window<"u"?window:typeof global<"u"?global:typeof globalThis<"u"?globalThis:typeof self<"u"?self:{},r=new s.Error().stack;r&&(s._sentryDebugIds=s._sentryDebugIds||{},s._sentryDebugIds[r]="fb41e25a-1174-44d4-8603-2d2de002cf9c",s._sentryDebugIdIdentifier="sentry-dbid-fb41e25a-1174-44d4-8603-2d2de002cf9c")}catch{}function Ne({item:s,index:r,match:o,updateItem:l}){const t=n=>l(r,Object.assign({tags:[]},s,n));let i;return o?i=["red","blue"].map(n=>e.jsxs(P,{className:"d-flex justify-content-between",style:{marginRight:"1em",padding:"0 5px 0 5px",backgroundColor:n==="red"?"#FFB2B2":"#B2D7FF"},children:[" ",o==null?void 0:o[n].map(a=>{var m;return a&&a.number>0?e.jsx("div",{className:"d-flex tagItem",children:e.jsx(P.Check,{id:`tag${r}${a.number}`,checked:(m=s.tags)==null?void 0:m.includes(a.number),onChange:j=>t({tags:j.target.checked?[...s.tags,a.number]:s.tags.filter(N=>N!==a.number)}),label:a.displayNumber})},a.number):null})," "]},n)):i=e.jsxs(P,{className:"d-flex justify-content-between",style:{marginRight:"1em",padding:"0 5px 0 5px"},children:[" ",s.tags.map(n=>n&&n>0?e.jsx("div",{className:"d-flex tagItem",children:e.jsx(P.Check,{id:`tag${r}${n}`,checked:!0,disabled:!0,label:n})},n):null)," "]}),e.jsxs(P.Group,{children:[e.jsx(P.Label,{className:"drop",children:d`Detail:`}),e.jsx(P.Control,{type:"text",disabled:!o,value:(s==null?void 0:s.content)||"",onChange:n=>t({content:n.target.value})}),e.jsxs("div",{className:"d-flex justify-content-left flex-wrap",style:{marginTop:".2em"},children:[e.jsx("span",{style:{marginRight:"1em"},children:d`Tags:`}),i]})]})}function ns({show:s,setShow:r,match:o,note:l,setNote:t,send:i}){var N,h;if(!l)return null;const n=(x,c)=>{if(!o)return;let u=Object.assign({},l);u.items||(u.items=[]),u.items[x]=Object.assign({},c),t(u)},a=((N=l.items)==null?void 0:N.map((x,c)=>e.jsx(Ne,{item:x,index:c,match:o,updateItem:n},c)))||[];if(o){const x=((h=l.items)==null?void 0:h.length)??0;a.push(e.jsx(Ne,{index:x,match:o,updateItem:n,item:{content:"",tags:[]}},x))}let m,j;if(o){const x=o==null?void 0:o.red.filter(u=>u&&u.number>0).map(u=>u.displayNumber).join(", "),c=o==null?void 0:o.blue.filter(u=>u&&u.number>0).map(u=>u.displayNumber).join(", ");m=e.jsxs(e.Fragment,{children:[e.jsx(P.Label,{children:d`Red: ${x} `}),e.jsx("br",{}),e.jsx(P.Label,{children:d`Blue: ${c} `}),e.jsx("br",{})]}),j=e.jsxs(e.Fragment,{children:[e.jsx(X,{variant:"secondary",onClick:()=>r(!1),children:d`Cancel`}),e.jsx(X,{variant:"primary",onClick:()=>{i(JSON.stringify({type:"NOTE",note:l})),r(!1)},children:d`Save`})]})}else m=e.jsx(P.Label,{children:"This note is from a match that is not part of the current event's match schedule and is read-only."}),j=e.jsx(X,{variant:"secondary",onClick:()=>r(!1),children:d`Done`});return e.jsxs(K,{show:s,onHide:()=>r(!1),size:"lg",className:"noteModal",children:[e.jsx(K.Header,{closeButton:!0,children:e.jsx(K.Title,{children:d`Match Note`})}),e.jsxs(K.Body,{children:[e.jsx(P.Label,{children:d`Match: ${l.match}`}),e.jsx("br",{}),m,e.jsx(P.Label,{className:"drop",children:d`General/Summary:`}),e.jsx(P.Control,{type:"text",value:l.summary||"",disabled:!o,onChange:x=>o?t(Object.assign({},l,{summary:x.target.value})):null}),a]}),e.jsx(K.Footer,{children:j})]})}function is({notes:s,matchList:r,showNote:o}){const l=n=>n.summary&&n.summary.length>0?n.summary:n.items.length===1?(n.items[0].tags.length>0?"["+n.items[0].tags.join(", ")+"] ":"")+n.items[0].content:n.items.length>1?"["+n.items.length+" notes]":"",t=[...r];for(const n of Object.values(s).sort((a,m)=>-Oe(a.match,m.match)))n.match!=="G"&&t.filter(a=>n.match===a.shortName).length===0&&t.splice(0,0,{shortName:n.match,fake:!0});const i=t.map(n=>e.jsxs("tr",{onClick:()=>o((s==null?void 0:s[n.shortName])??{match:n.shortName,items:[]}),children:[e.jsx("th",{children:n.shortName}),e.jsx("td",{children:s[n.shortName]?l(s[n.shortName]):null})]},n.shortName));return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"text-center",children:d`Tap on a row to open the notes for that match.`}),e.jsxs("table",{id:"notesTable",className:"table",children:[e.jsx("thead",{children:e.jsxs("tr",{id:"notesHeader",children:[e.jsx("th",{children:d`Match`}),e.jsx("th",{children:d`Notes`})]})}),e.jsx("tbody",{children:i})]})]})}function Oe(s,r){const o=s.lastIndexOf(" ");let l="";o>-1&&(l=s.substring(0,o),s=s.substring(o+1));const t=r.lastIndexOf(" ");let i="";t>-1&&(i=r.substring(0,t),r=r.substring(t+1));const n=a=>(a[2]==="1"?1:2)+parseInt(a.substring(4));if(l.length>0&&l!==i)return l.localeCompare(i);if(s[0]===r[0])return s[0]==="S"?n(s)-n(r):parseInt(s.substring(1))-parseInt(r.substring(1));{const a=m=>m[0]==="G"?-1:m[0]==="Q"?0:m[0]==="S"?1:2;return a(s)-a(r)}}function Le(s){const r=new Map;for(let o of Object.values(s).sort((l,t)=>Oe(l.match,t.match)))for(let l of o.items)for(let t of l.tags){const i=o.hasOwnProperty("summary")?o.summary:"",n=l.hasOwnProperty("content")?l.content:"",a=((i==null?void 0:i.length)??0)>0&&((n==null?void 0:n.length)??0)>0?"; ":"",m=i+a+n;r.set(t,[...r.get(t)??[],{match:o.match,content:m,others:l.tags.filter(j=>j!==t)}])}return r}function ls({notes:s,matchList:r,showNote:o}){const l=Le(s),t=[...new Set(r.flatMap(a=>[...a.red,...a.blue].map(m=>JSON.stringify(m))))].map(a=>JSON.parse(a)).filter(a=>a&&a.number>0).sort((a,m)=>a.number-m.number),i=a=>a.length===0?"":a.map((m,j)=>e.jsx("div",{children:`${m.match}: ${m.content}`},j)),n=t.map(a=>e.jsxs("tr",{onClick:()=>o(s,"team",a),children:[e.jsx("th",{children:a.displayNumber}),e.jsx("td",{children:i(l.get(a.number)??[])})]},a.number));return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"text-center",children:d`Tap on a row to open the notes for that team.`}),e.jsxs("table",{id:"notesTable",className:"table",children:[e.jsx("thead",{children:e.jsxs("tr",{id:"notesHeader",children:[e.jsx("th",{children:d`Team`}),e.jsx("th",{children:d`Notes`})]})}),e.jsx("tbody",{children:n})]})]})}function os({type:s,note:r,setNote:o,meetingNotes:l,send:t}){const[i,n]=C.useState(!1),a=Ie.find(j=>j.type===s);if(!a)return console.error(`Could not find meeting of type ${s}`),e.jsx(e.Fragment,{children:"An error occurred"});const m=a.label;return e.jsxs(e.Fragment,{children:[e.jsx("h4",{className:"text-center",children:d`${m} Meeting Notes`}),i?e.jsx(Ge,{theme:"snow",value:r??"",onChange:j=>{o(j)}}):e.jsx("div",{dangerouslySetInnerHTML:{__html:r}}),e.jsxs("div",{className:"d-flex justify-content-end meetingEditBtns",children:[e.jsx("button",{className:"btn btn-secondary",hidden:!i,onClick:()=>{o(l[s]||""),n(!1)},children:d`Discard`}),e.jsxs("button",{className:"btn btn-primary",hidden:i,onClick:()=>n(!0),children:[" ",d`Edit`]}),e.jsxs("button",{className:"btn btn-primary",hidden:!i,onClick:()=>{t(JSON.stringify({type:"MEETING_NOTE",meeting:s,content:r})),n(!1)},children:[" ",d`Save`]})]})]})}const Ie=[{type:re.REFEREE,label:d`Referee`},{type:re.DRIVER,label:d`Drivers`},{type:re.CAPTAIN,label:d`Captains`},{type:re.OTHER,label:d`Other`}];function ds({notes:s,meetingNotes:r,matchList:o,send:l,showNote:t}){const[i,n]=C.useState("match"),[a,m]=C.useState(re.REFEREE),[j,N]=C.useState("");let h=null;i==="match"?h=e.jsx(is,{notes:s,matchList:o,showNote:t}):i==="team"?h=e.jsx(ls,{notes:s,matchList:o,showNote:t}):i==="meeting"&&(h=e.jsx(os,{type:a,note:j,setNote:N,meetingNotes:r,send:l}));const x=u=>{N(r[u]||""),n("meeting"),m(u)},c=Ie.map(u=>e.jsx("a",{className:`dropdown-item ${i===`meeting_${u.type}`?"current":null}`,href:"#",onClick:()=>x(u.type),children:u.label},u.type));return e.jsxs("div",{id:"notes",className:"tab-pane fade show",role:"tabpanel",children:[e.jsxs("div",{className:"d-flex justify-content-center noteSelectBtns",style:{padding:"10px"},children:[e.jsx("button",{className:`btn ${i==="match"?"btn-outline-secondary":"btn-secondary"}`,onClick:()=>n("match"),children:d`By Match`}),e.jsx("button",{className:`btn ${i==="team"?"btn-outline-secondary":"btn-secondary"}`,onClick:()=>n("team"),children:d`By Team`}),e.jsxs("div",{className:"dropdown",children:[e.jsx("button",{id:"meetingDropdown",className:"btn btn-secondary dropdown-toggle","data-toggle":"dropdown","aria-haspopup":"true",children:d`Meeting`}),e.jsxs("div",{className:"dropdown-menu","aria-labelledby":"meetingDropdown",children:[" ",c," "]})]})]}),h]})}function as({show:s,setShow:r,notes:o,noteList:l,matchList:t,showNote:i,send:n}){var f,O,I;function a(p,g){var A,L;return g?((L=(A=p.G)==null?void 0:A.items.find(F=>F.tags.includes(g)))==null?void 0:L.content)??"":""}const[m,j]=C.useState(a(l)),[N,h]=C.useState(m);if(C.useEffect(()=>{var g;const p=a(l,(g=o==null?void 0:o.team)==null?void 0:g.number);h(p),j(p)},[o]),!o)return null;const x=[...t];for(const p in o.notes){const g=o.notes[p];g.match!=="G"&&x.filter(A=>g.match===A.shortName).length===0&&x.splice(0,0,{shortName:g.match,fake:!0})}const c=x.map(p=>e.jsxs("tr",{style:{border:"1px solid gray",width:"100%"},onClick:()=>p.hasOwnProperty("fake")?null:i((l==null?void 0:l[p.shortName])??{match:p.shortName,items:[]}),children:[e.jsx("th",{className:"h6 align-top",style:{maxWidth:"7ch",padding:"5px 10px 10px 0"},children:p.hasOwnProperty("fake")?p.shortName+":":e.jsx("a",{href:"#",onClick:g=>g.preventDefault(),children:p.shortName+":"})}),e.jsxs("td",{style:{fontSize:"1.2em"},children:[" ",o.notes.filter(g=>g.match===p.shortName).map((g,A)=>e.jsxs("div",{children:[g.content,g.others.length>0?e.jsxs(e.Fragment,{children:[" [+",g.others.map((L,F)=>e.jsxs(e.Fragment,{children:[F>0?", ":null,e.jsx("a",{href:"#",onClick:v=>{v.preventDefault(),i(l,"team",{number:L,displayNumber:L.toString()})},children:L},L)]})),"] "]}):null]},A))," "]})]},p.shortName)),u=(f=o.team)==null?void 0:f.displayNumber,T=(I=(O=o.team)==null?void 0:O.cards)==null?void 0:I.join(", ");return e.jsxs(K,{show:s,onHide:()=>r(!1),size:"lg",className:"noteModal",children:[e.jsx(K.Header,{closeButton:!0,children:e.jsx(K.Title,{children:d`Team ${u} Match Notes`})}),e.jsxs(K.Body,{children:[T?e.jsx("div",{className:"alert alert-warning",children:d`This team has received cards in matches: ${T}`}):null,e.jsx(P.Label,{className:"drop",children:d`General/Summary:`}),e.jsx(P.Control,{type:"text",value:N,onChange:p=>h(p.target.value)}),e.jsx("br",{}),e.jsx("table",{style:{borderCollapse:"collapse",width:"100%"},children:c})]}),e.jsxs(K.Footer,{children:[e.jsx(X,{variant:"secondary",hidden:m===N,onClick:()=>r(!1),children:d`Cancel`}),e.jsx(X,{variant:"primary",hidden:m===N,onClick:()=>{const p=l.G??{match:"G",items:[]},g=p.items.find(A=>A.tags.includes(o.team.number));g?g.content=N:p.items.push({content:N,tags:[o.team.number]}),n(JSON.stringify({type:"NOTE",note:p})),r(!1)},children:d`Save`}),e.jsx(X,{variant:"secondary",hidden:m!==N,onClick:()=>r(!1),children:d`Close`})]})]})}function _(s){return new Date(s).toLocaleTimeString().split(" ")[0]}function cs(s,r,o){const l=(t,i)=>(t.round??0)>(i.round??0)||(t.round??0)===(i.round??0)&&t.number>i.number;switch(s.type){case S.LAST_ON_FIELD:const t=s;let i=(o==null?void 0:o.field)===t.field,n=r.find(m=>l(m,{number:t.srcMatch,round:t.srcRound})&&m.field===t.field);return i?o:n;case S.SCHEDULED_START:return r.find(m=>m.number===s.match);case S.T206:case S.G301:return o;case S.ALLIANCE_LAST:const a=s;return r.find(m=>l(m,{number:a.srcMatch,round:a.srcRound})&&(m.redSeed===a.seed||m.blueSeed===a.seed));case S.T206_MATCH_DEPENDENCY:case S.RUNNING_MATCH:return}}function ms({timeout:s,nowCallback:r,selected:o,targetMatch:l}){const t=ne({startAt:s.timeoutStart,duration:s.timeoutDuration/1e3,nowCallback:r}),i=({timer:m})=>e.jsx("span",{style:o==s?{backgroundColor:"lime"}:void 0,children:q(m.remaining)}),n=({d:m})=>m?e.jsx("span",{children:q(m/1e3)}):"-";let a=()=>{var m,j;if(l){const N=l.redSeed,h=l.blueSeed,x=l.red[0].displayNumber,c=l.red[1].displayNumber,u=(m=l.red[2])==null?void 0:m.displayNumber,T=l.blue[0].displayNumber,f=l.blue[1].displayNumber,O=(j=l.blue[2])==null?void 0:j.displayNumber;es({label:l.name,dangerous:!0,text:`<table>
                    <tbody>
                        ${N?`<tr><td>Red:</td><td>A${N}</td></tr>`:""}
                        <tr><td>Red 1:</td><td>${x}</td></tr>
                        <tr><td>Red 2:</td><td>${c}</td></tr>
                        ${u?e.jsxs("tr",{children:[e.jsx("td",{children:"Red 3:"}),e.jsxs("td",{children:["$",u]})]}):""}
                        ${h?`<tr><td>Blue:</td><td>A${h}</td></tr>`:""}
                        <tr><td>Blue 1:</td><td>${T}</td></tr>
                        <tr><td>Blue 2:&nbsp;</td><td>${f}</td></tr>
                        ${O?e.jsxs("tr",{children:[e.jsx("td",{children:"Blue 3:"}),e.jsxs("td",{children:["$",O]})]}):""}
                    </tbody>
                </table>                    
            `})}};switch(s.type){case S.LAST_ON_FIELD:return e.jsxs("tr",{onClick:a,children:[e.jsx("td",{children:l==null?void 0:l.shortName}),e.jsx("td",{children:s.description}),e.jsx("td",{children:_(s.timeoutStart)}),e.jsx("td",{children:e.jsx(n,{d:s.timeoutDuration})}),e.jsx("td",{children:_(s.timeoutStart+s.timeoutDuration)}),e.jsx("td",{children:e.jsx(i,{timer:t})})]});case S.RUNNING_MATCH:return e.jsxs("tr",{onClick:a,children:[e.jsx("td",{}),e.jsx("td",{children:s.description}),e.jsxs("td",{children:[_(s.timeoutStart)," "]}),e.jsx("td",{children:e.jsx(n,{d:s.timeoutDuration})}),e.jsx("td",{children:_(s.timeoutStart+s.timeoutDuration)}),e.jsx("td",{children:e.jsx(i,{timer:t})})]});case S.T206:return s.awaitingScorePost?e.jsxs("tr",{onClick:a,children:[e.jsx("td",{children:l==null?void 0:l.shortName}),e.jsxs("td",{children:[d`Back-to-back for `,s.teams.join(",")]}),e.jsxs("td",{className:"alert-warning",children:[s.description.split(" ")[0]," Post"]}),e.jsx("td",{children:e.jsx(n,{d:s.timeoutDuration})}),e.jsx("td",{}),e.jsx("td",{children:e.jsx("span",{style:o===s?{backgroundColor:"lime"}:void 0,children:d`TBD`})})]}):e.jsxs("tr",{onClick:a,children:[e.jsx("td",{children:l==null?void 0:l.shortName}),e.jsxs("td",{children:[d`Back-to-back for `,s.teams.join(",")]}),e.jsx("td",{children:_(s.timeoutStart)}),e.jsx("td",{children:e.jsx(n,{d:s.timeoutDuration})}),e.jsx("td",{children:_(s.timeoutStart+s.timeoutDuration)}),e.jsx("td",{children:e.jsx(i,{timer:t})})]});case S.T206_MATCH_DEPENDENCY:return e.jsxs("tr",{onClick:a,children:[e.jsx("td",{}),e.jsxs("td",{children:["[",d`Depends on outcome`,"]"]}),e.jsxs("td",{className:"alert-warning",children:[s.description.split(" ")[0]," Post"]}),e.jsx("td",{children:e.jsx(n,{d:s.timeoutDuration})}),e.jsx("td",{}),e.jsx("td",{children:e.jsx("span",{style:o===s?{backgroundColor:"lime"}:void 0,children:d`TBD`})})]});case S.ALLIANCE_LAST:return e.jsxs("tr",{onClick:a,children:[e.jsx("td",{children:l==null?void 0:l.shortName}),e.jsx("td",{children:s.description}),e.jsx("td",{children:_(s.timeoutStart)}),e.jsx("td",{children:e.jsx(n,{d:s.timeoutDuration})}),e.jsx("td",{children:_(s.timeoutStart+s.timeoutDuration)}),e.jsx("td",{children:e.jsx(i,{timer:t})})]});case S.G301:return e.jsxs("tr",{onClick:a,children:[e.jsx("td",{className:"alert-danger",children:l==null?void 0:l.shortName}),e.jsx("td",{className:"alert-danger",children:s.description}),e.jsx("td",{children:_(s.timeoutStart)}),e.jsx("td",{children:e.jsx(n,{d:s.timeoutDuration})}),e.jsx("td",{children:_(s.timeoutStart+s.timeoutDuration)}),e.jsx("td",{children:e.jsx(i,{timer:t})})]});case S.SCHEDULED_START:return e.jsxs("tr",{onClick:a,children:[e.jsx("td",{children:l==null?void 0:l.shortName}),e.jsx("td",{children:d`Scheduled Time`}),e.jsx("td",{}),e.jsx("td",{}),e.jsx("td",{children:_(s.timeoutStart+s.timeoutDuration)}),e.jsx("td",{children:e.jsx(i,{timer:t})})]})}}function us(s,r){switch(r.type){case S.G301:return!1;case S.SCHEDULED_START:return r.match===(s==null?void 0:s.number);case S.T206:return r.targetMatch===s.number;case S.LAST_ON_FIELD:return r.field===s.field;case S.ALLIANCE_LAST:return[s.red.seed,s.blue.seed].includes(r.seed);case S.RUNNING_MATCH:return!0;case S.T206_MATCH_DEPENDENCY:return!0}}function ge(s){switch(s){case S.G301:return 0;case S.SCHEDULED_START:return 1;case S.T206_MATCH_DEPENDENCY:return 2;case S.T206:return 3;case S.LAST_ON_FIELD:return 4;case S.ALLIANCE_LAST:return 5;case S.RUNNING_MATCH:return 6}}function Fe(s,r,o){let l=r.filter(i=>us(s,i));if(l.length===0)return;const t=i=>(je(i)&&i.awaitingScorePost||ie(i)?o():i.timeoutStart)+i.timeoutDuration;return l.reduce((i,n)=>i&&t(i)>t(n)?i:n)}function ke(s,r){return s.round&&!r.round?-1:!s.round&&r.round?1:s.round&&r.round&&s.round!==r.round?s.round-r.round:s.number-r.number}function hs({field:s,activeMatch:r,matchList:o,timeouts:l,nextMatch:t,send:i,nowCallback:n}){var v,U,R,H,G,z,J,Z;const[a,m]=C.useState(_(n())),j=l.filter(Re)[0],N=ne({startAt:(j==null?void 0:j.timeoutStart)??0,duration:((j==null?void 0:j.timeoutDuration)??0)/1e3,nowCallback:n}),h=t?Fe(t,l,n):l.find(ie),x=ne({startAt:h==null?void 0:h.timeoutStart,duration:((h==null?void 0:h.timeoutDuration)??0)/1e3,nowCallback:n});he(()=>{m(_(n()))},200);const c=()=>{j?Me({label:d`Restart 2-Minute Timer`,text:d`Are you sure you want to restart the timer?`,buttonText:d`Restart`,onConfirm:()=>i(JSON.stringify({type:"G301_VIOLATION",time:n()}))}).catch():i(JSON.stringify({type:"G301_VIOLATION",time:n()}))},u={height:"100%",flexDirection:"row",alignItems:"center",justifyContent:"center"},T=h&&je(h)&&h.awaitingScorePost,f=h&&ie(h);let O;(y=>{y[y.NOT_APPLICABLE=0]="NOT_APPLICABLE",y[y.AWAITING_POST=1]="AWAITING_POST",y[y.AVAILABLE=2]="AVAILABLE",y[y.ACTIVE=3]="ACTIVE",y[y.NO_MATCH=4]="NO_MATCH"})(O||(O={}));let I=null,p=x.running?0:2;switch(t||(p=4),j&&(p=3),(T||f)&&(p=1),p){case 0:I=e.jsxs("div",{style:{},children:[e.jsx("div",{className:"font-italic",children:d`Minimum time before next match:`}),e.jsx("h1",{children:q(x.remaining)})]});break;case 4:I=e.jsxs("div",{style:{},children:[e.jsx("div",{className:"font-italic",children:d`No Match Available`}),e.jsx("h1",{})]});break;case 1:I=e.jsxs("div",{style:{},children:[e.jsx("div",{className:"font-italic",children:d`Minimum time before next match:`}),e.jsxs("h1",{children:[q(((h==null?void 0:h.timeoutDuration)??0)/1e3),"+"]}),e.jsxs("small",{className:"font-italic font-small",children:[d`Awaiting `,h==null?void 0:h.description]})]});break;case 2:I=e.jsxs("div",{className:"d-flex",style:u,children:[e.jsx("div",{className:"font-italic alert",style:{marginBottom:0},children:d`Match start time has passed!`}),e.jsx("h1",{})]});break;case 3:I=e.jsxs("div",{className:"alert-danger",style:{borderRadius:".25em"},children:[e.jsx("div",{className:"font-italic",children:d`2-Minute Warning Active:`}),e.jsx("h1",{children:q(N.remaining)})]});break}let g=t?" - "+t.shortName:"";const A=t&&s!==0&&t.field!==0&&t.field!==s;A&&(g+=d` [Other Field]`);const L=o.some(y=>y.type==="ELIMS")?o.filter(y=>y.type==="ELIMS"):o.slice();L.length>0&&L[0].type==="ELIMS"&&L.sort(ke);let F=l.map(y=>({to:y,target:cs(y,L,t)}));return F.sort((y,$)=>{var b,D,w,W,E,k,V,Q;return!y.target&&y.to.type===S.ALLIANCE_LAST&&($.to.type!==S.ALLIANCE_LAST||$.target)?1:!$.target&&$.to.type===S.ALLIANCE_LAST&&(y.to.type!==S.ALLIANCE_LAST||y.target)?-1:((b=y.target)==null?void 0:b.number)===((D=$.target)==null?void 0:D.number)?ge(y.to.type)-ge($.to.type):(((w=y.target)==null?void 0:w.round)??0)!==(((W=$.target)==null?void 0:W.round)??0)?(((E=y.target)==null?void 0:E.round)??0)-(((k=$.target)==null?void 0:k.round)??0):(((V=y.target)==null?void 0:V.number)??0)-(((Q=$.target)==null?void 0:Q.number)??0)}),e.jsxs("div",{className:"tab-pane fade show hrTiming",role:"tabpanel",children:[e.jsx("h4",{className:"text-center",style:{marginTop:"1ch"},children:d`${"G301"} Timing${g}`}),(t==null?void 0:t.type)===fe.ELIMS?e.jsxs("h6",{className:"text-center",style:{marginTop:"1ch"},children:["Red: A",(v=t==null?void 0:t.red)==null?void 0:v.seed,"  Blue: A",(U=t==null?void 0:t.blue)==null?void 0:U.seed]}):e.jsxs("h6",{className:"text-center",style:{marginTop:"1ch"},hidden:!(t!=null&&t.red)||!(t!=null&&t.blue),children:["Red: ",(R=t==null?void 0:t.red.team1)==null?void 0:R.data.number,", ",(H=t==null?void 0:t.red.team2)==null?void 0:H.data.number," ",t!=null&&t.red.team3?e.jsxs(e.Fragment,{children:[", ",(G=t==null?void 0:t.red.team3)==null?void 0:G.data.number]}):null,"    Blue: ",(z=t==null?void 0:t.blue.team1)==null?void 0:z.data.number,", ",(J=t==null?void 0:t.blue.team2)==null?void 0:J.data.number," ",t!=null&&t.blue.team3?e.jsxs(e.Fragment,{children:[", ",(Z=t==null?void 0:t.blue.team3)==null?void 0:Z.data.number]}):null]}),e.jsxs("div",{className:"text-center justify-content-around",style:{display:"grid",gridTemplateColumns:"50% 50%",gridColumnGap:"1ch"},children:[I,e.jsxs("div",{className:"d-flex",style:u,children:[e.jsx("div",{className:"alert alert-warning",style:{marginBottom:0},hidden:![0,1,4].includes(p)||A,children:d`2-Minute Warning Not Allowed!`}),e.jsx("div",{className:"alert alert-warning",style:{marginBottom:0},hidden:!A,children:d`Cannot start other field's warning!`}),e.jsx("div",{className:"alert alert-warning",style:{marginBottom:0},hidden:!((r==null?void 0:r.type)==="TEST"||(t==null?void 0:t.type)==="TEST"),children:d`Cannot violate G301 in Test Match!`}),e.jsx(X,{variant:p===2?"success":"danger",size:"lg",style:{margin:0},hidden:[1,0,4].includes(p)||A||(r==null?void 0:r.type)==="TEST"||(t==null?void 0:t.type)==="TEST",onClick:c,children:p===2?d`Start 2-Minute Warning`:d`Restart 2-Minute Warning`})]})]}),e.jsx("hr",{}),e.jsx("h4",{className:"text-center",style:{marginTop:"1ch"},children:d`All Timing`}),e.jsx("div",{className:"text-center",style:{marginTop:"-1ch",marginBottom:".5ch"},children:d`Current time: ${a}`}),e.jsxs("table",{id:"timeoutTable",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{style:{minWidth:"4ch"},children:"M"}),e.jsx("th",{children:"Type"}),e.jsx("th",{style:{minWidth:"8ch"},children:"Start"}),e.jsx("th",{children:"Length"}),e.jsx("th",{children:"End"}),e.jsx("th",{children:"Left"})]})}),e.jsx("tbody",{children:F.map(y=>e.jsx(ms,{timeout:y.to,targetMatch:y.target,nowCallback:n,selected:h},y.to.description))})]})]})}function js({matchLists:s,divisionNames:r}){const[o,l]=C.useState(window.division),[t,i]=C.useState(null),[n,a]=C.useState("red"),[m,j]=C.useState(null),[N,h]=ae("hr-scoresheet-playoff-only",!1);C.useEffect(()=>{(async()=>{if(!t||!n){j(null);return}let f=window.eventCode;f.endsWith("_0")&&(f=f.slice(0,-2)+"_"+o);const O=`/event/${f}/match/${t.toLowerCase()}/${n!=="both"?n+"/":""}?embed=true`,p=await(await fetch(O)).text();j(p)})()},[o,t,n]);const x={red:d`Red`,blue:d`Blue`,both:d`Both`},u=(s[o]||[]).filter(f=>N?f.type==="ELIMS":!0).toSorted(ke).map(f=>e.jsx("option",{value:f.shortName,children:f.shortName},f.shortName)),T=["red","blue","both"].map(f=>e.jsxs("div",{className:"form-check-inline",children:[e.jsx("input",{className:"form-check-input",type:"radio",name:"scoresheetOption",id:"scoresheetRadio_"+f,value:f,checked:f===n,onChange:O=>{O.target.checked&&a(f)}}),e.jsx("label",{className:"form-check-label",htmlFor:"scoresheetRadio_"+f,children:x[f]})]},f));return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"text-center",style:{marginTop:"10px"},children:[r?e.jsxs(e.Fragment,{children:[e.jsx("label",{style:{marginRight:"10px"},children:d`Division: `}),e.jsx("select",{value:o,onChange:f=>{l(parseInt(f.target.value)),i(null)},className:"mr-4",children:r.map((f,O)=>e.jsx("option",{value:O,children:f||"Parent"},O))})]}):null,e.jsx("label",{style:{marginRight:"10px"},children:d`Match: `}),e.jsxs("select",{value:t||"-placeholder-",onChange:f=>i(f.target.value),children:[e.jsx("option",{value:"-placeholder-",disabled:!0,children:d`Select Match`}),u]}),e.jsxs("div",{className:"form-check-inline ml-4",children:[e.jsx("label",{className:"form-check-label mr-1",htmlFor:"scoresheetPlayoffOnly",children:d`Playoff Only: `}),e.jsx("input",{className:"form-check-input",type:"checkbox",name:"scoresheetOption",id:"scoresheetPlayoffOnly",checked:N,onChange:f=>{h(f.target.checked)}})]})]}),e.jsx("div",{className:"text-center",children:T}),m?e.jsx("div",{className:"scoresheetContainer",dangerouslySetInnerHTML:{__html:m}}):null]})}const fs=({value:s})=>e.jsx("i",{className:`${s===2?"far":"fa"} fa-fw fa-${s===void 0?"minus":s>0?s===2?"check-square":"check":"times"}`}),xs=({value:s})=>s===1?"Partial":s>1?"Full":e.jsx("i",{className:"fa fa-times fa-fw"}),se=({value:s})=>e.jsx(e.Fragment,{children:Math.max(s,0)}),bs=({value:s})=>e.jsx(e.Fragment,{children:s});function ye({flip:s,alliance:r,team:o,noShow:l,card:t,carry:i,updateCard:n,showCard:a,noteCount:m,showNote:j}){const N=["white","yellow","red","linear-gradient(to bottom right, yellow 0%,yellow 50%,red 50%,red 50%)"],h=[d`None`,d`YC`,d`RC`,d`2nd YC`],x=e.jsxs("div",{className:`col-3 text-center ${r} team ${i!=null&&i.length?"carries":null} ${l?"noshow":null}`,onClick:()=>j(),children:[o,m>0?e.jsxs("span",{className:"ml-2 position-relative",children:[e.jsx("i",{className:"fa fa-comment"}),e.jsx("span",{className:"refNoteCount",children:m})]}):null]});let c=e.jsx("div",{className:`col-3 text-center ${r} card`,onClick:()=>n(r.toUpperCase()),style:{background:N[t]},children:h[t]});return a||(c=e.jsx("div",{className:`col-3 text-center ${r}`})),e.jsxs(e.Fragment,{children:[s?c:x,s?x:c]})}function te(s){return{type:"UPDATE",match:s.number,review:s.hrReview,hrCards:s.hrCards,hrViolations:s.hrViolations,redMinor:s.red.scores.hrMinorFouls,redMajor:s.red.scores.hrMajorFouls,blueMinor:s.blue.scores.hrMinorFouls,blueMajor:s.blue.scores.hrMajorFouls}}const Te={0:1,1:3,3:2,2:0};function ue({activeMatch:s,flip:r,robot:o,send:l,showCard:t,notes:i,showNote:n,initialCards:a}){var v,U,R,H,G,z,J,Z,y,$,b,D;const m=s.type!=="QUALS"&&s.type!=="TEST",j=(U=(v=s.red[`team${o}`])==null?void 0:v.data)==null?void 0:U.displayNumber,N=(H=(R=s.red[`team${o}`])==null?void 0:R.data)==null?void 0:H.number,h=(z=(G=s.blue[`team${o}`])==null?void 0:G.data)==null?void 0:z.displayNumber,x=(Z=(J=s.blue[`team${o}`])==null?void 0:J.data)==null?void 0:Z.number,c=(y=s.redData)==null?void 0:y[`cc${o==3?2:o}`],u=($=s.blueData)==null?void 0:$[`cc${o==3?2:o}`],T=s.hrCards.RED[o===3?0:o-1],f=s.hrCards.BLUE[o===3?0:o-1],O=s.red.scores[`noshow${o}`],I=s.blue.scores[`noshow${o}`],p=N&&((b=i.get(N))==null?void 0:b.length)||0,g=x&&((D=i.get(x))==null?void 0:D.length)||0,A=w=>{const W=w==="RED"?T:f,E=w==="RED"?c==null?void 0:c.length:u==null?void 0:u.length;let k=Te[W];console.log(E,s.isReplay),k==1&&E&&(!s.isReplay||a&&a[w][o-1]==0)&&(k=Te[k]);const V=te(s);V.review=!0,m?V.hrCards[w].fill(k,0,3):V.hrCards[w][o-1]=k,l(JSON.stringify(V))},L=e.jsx(ye,{flip:!r,alliance:"red",team:j,noShow:O,card:T,carry:c,updateCard:A,showCard:t,noteCount:p,showNote:()=>N&&j&&n(N,j,c)}),F=e.jsx(ye,{flip:r,alliance:"blue",team:h,noShow:I,card:f,carry:u,updateCard:A,showCard:t,noteCount:g,showNote:()=>x&&h&&n(x,h,u)});return!j&&!h&&o===3?null:e.jsxs("div",{className:"row cardRow",children:[r?L:F,r?F:L]})}function Ee({activeMatch:s,alliance:r,send:o}){const l=(t,i)=>{const n=te(s);n.review=!0,t?n.hrViolations[r].push(i):n.hrViolations[r]=n.hrViolations[r].filter(a=>a!==i),o(JSON.stringify(n))};return e.jsx("div",{className:"rpInputBlock",style:{maxWidth:"calc(min(40%, 28ch))"},children:["G206","G417.A","G418.A","G418.B","G419.B","G431.C"].map(t=>e.jsx(P.Check,{label:t,checked:s.hrViolations[r].includes(t),id:r+"_"+t,onChange:i=>l(i.target.checked,t),inline:!0,style:{minWidth:"5.5em"}},t))})}function B({activeMatch:s,flip:r,id:o,fieldName:l,label:t,component:i=bs,classFn:n}){const a=(x,c)=>{const u=typeof l=="object"&&!Array.isArray(l)?l[c]:l;if(Array.isArray(u))return u.flatMap((T,f)=>[" / ",e.jsx(i,{value:x[T],alliance:c},`${f}-body`)]).slice(1);if(u)return e.jsx(i,{value:x[u],alliance:c});{const T=i;return e.jsx(T,{alliance:c})}},m=(x,c)=>{const u=typeof l=="object"&&!Array.isArray(l)?l[c]:l;return Array.isArray(u)?u.map(T=>x[T]):x[u]},j=a(s.red.scores,Y.RED),N=a(s.blue.scores,Y.BLUE),h=n?l?n(m(s.red.scores,Y.RED),m(s.blue.scores,Y.BLUE)):n():null;return e.jsxs("div",{className:"row scoreRow",id:o,children:[e.jsx("div",{className:`col-4 d-flex justify-content-center align-items-center ${r?"red":"blue"} ${r?h==null?void 0:h.red:h==null?void 0:h.blue} p-0`,children:r?j:N}),e.jsx("div",{className:`col-4 text-center middle ${h==null?void 0:h.middle}`,children:t}),e.jsx("div",{className:`col-4 d-flex justify-content-center align-items-center ${r?"blue":"red"} ${r?h==null?void 0:h.blue:h==null?void 0:h.red} p-0`,children:r?N:j})]})}function Se(s,r,o,l){if(o==="UNPLAYED"||o=="RANDOMIZED")return s==="READY"?"ready":o==="RANDOMIZED"?l?"blocking":"conflict":l?"blocking":void 0;if(r.done)return s==="SUBMIT"?"ready":s==="REVIEW"?void 0:"conflict";if(r.auto)return s==="AUTO"?void 0:"conflict";if(r.transition)return["AUTO","TELEOP"].includes(s)?void 0:"conflict";if(r.teleop||r.endgame)return s==="TELEOP"?void 0:"conflict"}function ps(s,r){return s.state==="UNPLAYED"||s.state=="RANDOMIZED"?s.state==="UNPLAYED"?d`Unplayed`:d`Randomized`:r.auto?"AUTO":r.transition?d`Transition`:r.teleop||r.endgame?"TELEOP":d`Review`}function Ae({value:s,alliance:r}){return e.jsx("div",{className:`big-value ${r.toLowerCase()}`,children:e.jsx("div",{className:"value",children:s})})}function Ns({activeMatch:s,notes:r,showNote:o,send:l,nowCallback:t,flip:i,setFlip:n,fullscreen:a,autoOpen:m,setAutoOpen:j,dcOpen:N,setDcOpen:h,waitForInitSubmit:x,field:c,fieldCount:u}){const[T,f]=C.useState(!1),[O,I]=C.useState(!1),p=_e({startAt:s&&s.start&&s.start>0&&s.state!=="RANDOMIZED"?s.start:null,duration:158,nowCallback:t}),g=s!=null&&s.isReplay?{RED:[s.red.scores.oldCard1,s.red.scores.oldCard2],BLUE:[s.blue.scores.oldCard1,s.blue.scores.oldCard2]}:{RED:[0,0],BLUE:[0,0]},A=(s==null?void 0:s.isReplay)&&(g.RED.some(b=>b>0)||g.BLUE.some(b=>b>0)),L=Pe("img/decode/gate.svg");C.useEffect(()=>{(A||s!=null&&s.hrCards.RED.some(b=>b>0)||s!=null&&s.hrCards.BLUE.some(b=>b>0))&&f(!0)},[s,A]),C.useEffect(()=>{A&&R(!0)},[A]);const F=C.useMemo(()=>Le(r),[r]),v=(b,D,w)=>o(r,"teamWithCards",{number:b,displayNumber:D,cards:w}),U=C.useCallback(({value:b})=>e.jsx("div",{className:"text-nowrap",children:[...b].reverse().map((D,w)=>[w%3==0?e.jsx(oe,{src:w==0?be:"",className:"classifier-icon"},`${w}-3`):null,e.jsx(de,{value:D,matches:s&&M[s.randomization]?M[s.randomization][2-w%3]==D:!1},`${w}-2`),w%3==2?e.jsxs(e.Fragment,{children:[e.jsx(oe,{src:w==8?L:"",className:"classifier-icon"},`${w}-3`),e.jsx("br",{})]}):null])}),[s==null?void 0:s.randomization]);if(!s)return e.jsx("div",{id:"match",className:"tab-pane fade show active alert alert-info text-center",role:"tabpanel",children:d`No Active Match`});const R=b=>l(JSON.stringify(Object.assign(te(s),{review:b}))),H=s.state==="REVIEW"&&s.hrReview&&s.redData.status==="SUBMIT"&&s.blueData.status==="SUBMIT",G=(b,D)=>JSON.stringify(b.hrCards.RED)!==JSON.stringify(D.RED)||JSON.stringify(b.hrCards.BLUE)!==JSON.stringify(D.BLUE),z=(b,D,w)=>{const W=te(s),E=b.toLowerCase();W[`${E}${D}`]=w,l(JSON.stringify(W))},J=b=>{b.preventDefault(),j(b.target.parentElement.open?-1:1)},Z=b=>{b.preventDefault(),h(b.target.parentElement.open?-1:1)},y=ps(s,p),$=s.randomization>0?["","MOTIF 1 (ID 21)","MOTIF 2 (ID 22)","MOTIF 3 (ID 23)"][s.randomization]:"-";return e.jsxs("div",{id:"match",className:"tab-pane fade show active",role:"tabpanel",children:[e.jsx("h4",{className:"text-center",children:s.name}),u>1&&c===0?e.jsx("div",{className:"text-center",children:d`Field: ${s.field}`}):null,e.jsx("div",{className:"text-center",children:d`Match Status: ${y}`}),e.jsx("div",{className:"text-center",children:d`Randomization: ${$}`}),e.jsxs("div",{className:"text-center hr-artifacts",children:[e.jsx(oe,{src:L,className:"randomizer-icon"}),e.jsx(de,{value:s.randomization>0?M[s.randomization][0]:me.NONE}),e.jsx(de,{value:s.randomization>0?M[s.randomization][1]:me.NONE}),e.jsx(de,{value:s.randomization>0?M[s.randomization][2]:me.NONE}),e.jsx(oe,{src:be,className:"randomizer-icon"})]}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between"},children:[e.jsx("button",{className:"btn btn-info",onClick:()=>n(!i),children:d`Flip Alliances`}),e.jsxs("button",{className:`btn ${s.hrReview?"btn-success":"btn-warning"}`,disabled:H,onClick:()=>R(!s.hrReview||G(s,g)),children:[s.hrReview?d`Review Required `:d`Review Required?`,e.jsx("i",{className:"fa fa-check",hidden:!s.hrReview})]}),e.jsx("button",{className:"btn btn-info",onClick:()=>o((r==null?void 0:r[s.shortName])??{match:s.shortName,items:[]}),children:d`Add Note`})]}),s.hrReview?H?e.jsx("div",{className:"text-center font-italic alert alert-warning",children:d`Scores being held until you submit completion of review.`}):e.jsx("div",{className:"text-center font-italic",children:d`Scores will be held until you submit completion of review`}):null,e.jsx("hr",{}),e.jsx(B,{activeMatch:s,flip:i,label:"Referee Status",id:"statusHeader",component:({alliance:b})=>b==="RED"?d`Red`:d`Blue`,classFn:()=>({red:"font-weight-bold",middle:"font-weight-bold",blue:"font-weight-bold"})}),e.jsx(B,{activeMatch:s,flip:i,label:d`Scoring Phase`,component:({alliance:b})=>{const D=b.toLowerCase();return s[`${D}Data`].status},classFn:()=>({red:Se(s.redData.status,p,s.state,x),blue:Se(s.blueData.status,p,s.state,x)})}),e.jsx(B,{activeMatch:s,flip:i,label:e.jsxs(e.Fragment,{children:["MINOR FOULS",e.jsx("br",{}),e.jsx("b",{children:d`Total`})]}),fieldName:"minor",component:Ae}),e.jsx(B,{activeMatch:s,flip:i,label:e.jsx(e.Fragment,{children:"Foul input: R / B"}),fieldName:{RED:["ownMinorFouls","otherMinorFouls"],BLUE:["otherMinorFouls","ownMinorFouls"]}}),e.jsx(B,{activeMatch:s,flip:i,label:d`HR MINOR FOULS`,fieldName:"hrMinorFouls",component:({value:b,alliance:D})=>e.jsx(pe,{color:D,value:b,plain:!0,setValue:w=>z(D,"Minor",w)})}),e.jsx(B,{activeMatch:s,flip:i,label:e.jsxs(e.Fragment,{children:["MAJOR FOULS",e.jsx("br",{}),e.jsx("b",{children:d`Total`})]}),fieldName:"major",component:Ae}),e.jsx(B,{activeMatch:s,flip:i,label:e.jsx(e.Fragment,{children:"Foul input: R / B"}),fieldName:{RED:["ownMajorFouls","otherMajorFouls"],BLUE:["otherMajorFouls","ownMajorFouls"]}}),e.jsx(B,{activeMatch:s,flip:i,label:d`HR MAJOR FOULS`,fieldName:"hrMajorFouls",component:({value:b,alliance:D})=>e.jsx(pe,{color:D,value:b,plain:!0,setValue:w=>z(D,"Major",w)})}),e.jsx("hr",{}),e.jsxs("details",{className:"scores autoScores",open:a&&m===0||m===1,children:[e.jsx("summary",{className:"btn btn-secondary btn-sm col-12",onClick:J,children:d`AUTO Scores`}),e.jsx(B,{activeMatch:s,flip:i,label:d`CLASSIFIED`,fieldName:"autoClassifiedArtifacts",component:se}),e.jsx(B,{activeMatch:s,flip:i,label:d`OVERFLOW`,fieldName:"autoOverflowArtifacts",component:se}),e.jsx(B,{activeMatch:s,flip:i,label:d`PATTERN`,fieldName:"autoClassifierState",component:U}),e.jsx(B,{activeMatch:s,flip:i,label:d`ROBOT Location`,fieldName:["robot1Auto","robot2Auto"],component:fs})]}),e.jsxs("details",{className:"scores",open:a&&N===0||N===1,children:[e.jsx("summary",{className:"btn btn-secondary btn-sm col-12",onClick:Z,children:d`TELEOP Scores`}),e.jsx(B,{activeMatch:s,flip:i,label:d`CLASSIFIED`,fieldName:"teleopClassifiedArtifacts",component:se}),e.jsx(B,{activeMatch:s,flip:i,label:d`OVERFLOW`,fieldName:"teleopOverflowArtifacts",component:se}),e.jsx(B,{activeMatch:s,flip:i,label:d`DEPOT`,fieldName:"teleopDepotArtifacts",component:se}),e.jsx(B,{activeMatch:s,flip:i,label:d`PATTERN`,fieldName:"teleopClassifierState",component:U}),e.jsx(B,{activeMatch:s,flip:i,label:d`ROBOT Location`,fieldName:["robot1Teleop","robot2Teleop"],component:xs})]}),e.jsx("hr",{}),s&&s.type!=fe.ELIMS?e.jsxs(e.Fragment,{children:[e.jsx("h6",{className:"text-center",children:d`RP Violations`}),O?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"d-flex justify-content-between",style:{position:"relative"},children:[e.jsx(Ee,{activeMatch:s,alliance:i?Y.RED:Y.BLUE,send:l}),e.jsx(Ee,{activeMatch:s,alliance:i?Y.BLUE:Y.RED,send:l})]}),e.jsx("div",{className:"text-center",children:e.jsx("button",{className:"btn btn-info btn-sm",onClick:()=>I(!1),disabled:s.hrViolations[Y.BLUE].length>0||s.hrViolations[Y.RED].length>0,children:"Hide RP Violations"})})]}):e.jsx("div",{className:"text-center",children:e.jsx("button",{className:"btn btn-info btn-sm",onClick:()=>I(!0),children:"Enter RP Violations"})}),e.jsx("hr",{})]}):null,e.jsx("h6",{className:"text-center",children:d`Teams / Cards`}),e.jsxs("div",{style:{position:"relative"},children:[T?null:e.jsx("div",{className:"text-center",style:{position:"absolute",top:"1.5em",left:0,right:0,marginLeft:"auto",marginRight:"auto",zIndex:5,width:"fit-content"},children:e.jsx("button",{className:"btn btn-info btn-sm",onClick:()=>f(!0),children:"Assign Cards"})}),e.jsx(ue,{activeMatch:s,flip:i,robot:1,send:l,showCard:T,notes:F,showNote:v,initialCards:g}),e.jsx(ue,{activeMatch:s,flip:i,robot:2,send:l,showCard:T,notes:F,showNote:v,initialCards:g}),e.jsx(ue,{activeMatch:s,flip:i,robot:3,send:l,showCard:T,notes:F,showNote:v,initialCards:g}),A?e.jsx("div",{className:"text-center font-italic",children:d`This is a replay - cards earned in this match have been restored. Enter an additional YC as a 2nd YC.`}):null,T?e.jsx("div",{className:"text-center",style:{paddingTop:"5px"},children:e.jsx("button",{className:"btn btn-info btn-sm",onClick:()=>f(!1),disabled:s.hrCards.RED.some(b=>b>0)||s.hrCards.BLUE.some(b=>b>0),children:"Hide Cards"})}):null]}),H?e.jsxs(e.Fragment,{children:[e.jsx("br",{}),e.jsx("div",{className:"text-center",children:e.jsx("button",{className:"btn btn-primary",onClick:()=>{const b=te(s);b.type="SUBMIT",l(JSON.stringify(b))},children:d`Submit Review`})})]}):null]})}function gs({eventCode:s,field:r,showMatchTab:o}){const{displayUpdates:l,settings:t,isArchived:i,loadedMatch:n,activeMatch:a,remaining:m,loadMatch:j,nextMatchNum:N}=Ve(s,r),h=a&&(a==null?void 0:a.state)!=="REVIEW"&&(a==null?void 0:a.state)!=="SUBMITTED",x=n&&!h&&a&&a.postedTime<a.start;return e.jsxs(e.Fragment,{children:[e.jsx(ze,{loadedMatch:n,activeMatch:a,matchRemaining:m,compact:!0,settings:t}),e.jsx("br",{}),x?e.jsx(rs,{variant:"warning",className:"text-center",children:"If next match is started before post, the previous match will be inaccessible from this page and the control page must be used to post."}):null,e.jsx(Je,{loadedMatch:n,activeMatch:a,previewMatch:c=>Qe(s,c),randomizeMatch:(c,u)=>qe(s,c,u),showRandom:c=>Ze(s,c),showMatch:c=>Ke(s,c),startMatch:c=>{Xe(s,c).then(o)},abortMatch:c=>Ye(s,c),commitAndPostMatch:c=>We(s,c,[],!0),hasNextMatch:N>0,loadNextMatch:()=>j(N),displayUpdates:Object.values(l),settings:t,isArchived:i,warnIfNotPost:!0}),e.jsx("br",{}),e.jsx("em",{children:"This workflow is a beta feature. It is intended to allow small or short-staffed events to run a standardized basic match flow without a scorekeeper. It does not replace the need to have a computer with the control page open. Any post-referee score edits, out-of-order match play, Alliance Selection, and other operations must still be performed through the control page."})]})}function ys({divisionTimeoutData:s,divisionNames:r,nowCallback:o}){const[l,t]=C.useState(_(o())),i=Object.entries(s).filter(n=>!!n).map(([n,a])=>[parseInt(n),a]).filter(([n])=>n>0).sort((n,a)=>n[0]-a[0]);return he(()=>{t(_(o()))},200),e.jsxs("div",{className:"tab-pane fade show hrTiming",role:"tabpanel",children:[e.jsx("div",{className:"text-center mt-2 mb-2",style:{marginTop:"-1ch",marginBottom:".5ch"},children:d`Current time: ${l}`}),e.jsx("div",{className:"d-flex flex-wrap align-items-stretch",children:i.map(n=>e.jsx(Ts,{div:n[0],data:n[1],divisionNames:r,nowCallback:o},n[0]))})]})}function Ts({div:s,data:r,divisionNames:o,nowCallback:l}){var I,p,g,A,L,F,v,U;const t=r.timeouts.filter(Re)[0],i=ne({startAt:(t==null?void 0:t.timeoutStart)??0,duration:((t==null?void 0:t.timeoutDuration)??0)/1e3,nowCallback:l}),n=r.nextMatch?Fe(r.nextMatch,r.timeouts,l):r.timeouts.find(ie),a=ne({startAt:n==null?void 0:n.timeoutStart,duration:((n==null?void 0:n.timeoutDuration)??0)/1e3,nowCallback:l}),[m,j]=C.useState(-1),N=n&&je(n)&&n.awaitingScorePost,h=n&&ie(n);let x;(R=>{R[R.NOT_APPLICABLE=0]="NOT_APPLICABLE",R[R.AWAITING_POST=1]="AWAITING_POST",R[R.AVAILABLE=2]="AVAILABLE",R[R.ACTIVE=3]="ACTIVE",R[R.NO_MATCH=4]="NO_MATCH"})(x||(x={}));const c=r.nextMatch,u=r.matchList.filter(R=>R.start>0).sort((R,H)=>H.start-R.start)[0];he(()=>{j(u!=null&&u.start?Math.floor((l()-(u==null?void 0:u.start))/1e3):-1)},u!=null&&u.start?100:null);let T=null,f=a.running?0:2;r.nextMatch||(f=4),t&&(f=3),(N||h)&&(f=1);const O={flexDirection:"row",alignItems:"center",justifyContent:"center"};switch(f){case 0:T=e.jsxs("div",{style:{},children:[e.jsx("div",{className:"font-italic",children:d`Minimum time before next match:`}),e.jsx("h4",{children:q(a.remaining,!0)})]});break;case 4:T=e.jsxs("div",{style:{},children:[e.jsx("div",{className:"font-italic",children:d`No Match Available`}),e.jsx("h4",{})]});break;case 1:T=e.jsxs("div",{style:{},children:[e.jsx("div",{className:"font-italic",children:d`Minimum time before next match:`}),e.jsxs("h4",{children:[q(((n==null?void 0:n.timeoutDuration)??0)/1e3),"+"]}),e.jsxs("small",{className:"font-italic font-small",children:[d`Awaiting `,n==null?void 0:n.description]})]});break;case 2:T=e.jsxs("div",{className:"d-flex alert-warning",style:O,children:[e.jsx("div",{className:"font-italic alert",style:{marginBottom:0},children:d`Match start time has passed!`}),e.jsx("h4",{})]});break;case 3:T=e.jsxs("div",{className:"alert-danger",children:[e.jsx("div",{className:"font-italic",children:d`2-Minute Warning Active:`}),e.jsx("h4",{children:q(i.remaining)})]});break}return e.jsxs("div",{style:{minWidth:"50%",border:"1px solid black",flexGrow:1},children:[e.jsx("h3",{className:"text-center",children:o?o[s]:""}),e.jsxs("h6",{className:"text-center",children:["Last Match: ",(u==null?void 0:u.shortName)??"",m>0?` [${q(m,!0)} ago - ${ss(u==null?void 0:u.scheduledStart,u==null?void 0:u.start)}]`:""]}),e.jsxs("h6",{className:"text-center",children:["Next Match: ",(c==null?void 0:c.shortName)??"",c!=null&&c.scheduledStart?" ["+_(c==null?void 0:c.scheduledStart)+"]":""]}),(c==null?void 0:c.type)===fe.ELIMS?e.jsxs("h6",{className:"text-center",style:{marginTop:"1ch"},children:["Red: A",(I=c==null?void 0:c.red)==null?void 0:I.seed,"  Blue: A",(p=c==null?void 0:c.blue)==null?void 0:p.seed]}):e.jsxs("h6",{className:"text-center",style:{marginTop:"1ch"},hidden:!(c!=null&&c.red)||!(c!=null&&c.blue),children:["Red: ",(g=c==null?void 0:c.red.team1)==null?void 0:g.data.number,", ",(A=c==null?void 0:c.red.team2)==null?void 0:A.data.number," ",c!=null&&c.red.team3?e.jsxs(e.Fragment,{children:[", ",(L=c==null?void 0:c.red.team3)==null?void 0:L.data.number]}):null,"    Blue: ",(F=c==null?void 0:c.blue.team1)==null?void 0:F.data.number,", ",(v=c==null?void 0:c.blue.team2)==null?void 0:v.data.number," ",c!=null&&c.blue.team3?e.jsxs(e.Fragment,{children:[", ",(U=c==null?void 0:c.blue.team3)==null?void 0:U.data.number]}):null]}),e.jsx("div",{className:"text-center justify-content-around",children:T})]})}function Es(s,r){return s.find(o=>o.shortName===r)}function Ce(s){return s==="AUTO"||s==="TELEOP"}function Ss(s,r,o,l){if(s&&r.type==="CANCEL"&&r.matchNum===s.number)return;if(!r.match)return s;let t=Object.assign({},s);if((l===0||r.match.field===l||r.match.field===0)&&(!s||s.shortName===r.match.shortName||!Ce(s.state)&&!s.hrReview)&&((s==null?void 0:s.state)==="REVIEW"&&s.shortName!==r.match.shortName&&!Ce(r.match)||(t=r.match)),r.division===window.division&&t&&t.state==="SUBMITTED"){s!=null&&setTimeout(()=>o(JSON.stringify({type:"FETCH",field:l,first:!1})),2e3);return}return Object.keys(t).length>0?t:s}const Be={matchList:[],activeMatch:void 0,notes:{},meetingNotes:{},timeouts:[],nextMatch:void 0,g301Start:0,waitForInitSubmit:!1};function As(s,r,o,l){const t=r.division,i=s[t]?{...s[t]}:{...Be};return r.type==="MATCH_LIST"?i.matchList=r.list:r.type==="NOTES"?(i.notes=r.notes,i.meetingNotes=r.meetings):r.type==="TIMEOUTS"?(i.g301Start=r.g301Timer,i.timeouts=r.timeouts,i.nextMatch=r.nextMatch):["LOAD","INIT","START","SCORE","REVIEW","ABORT","RANDOMIZE","FETCH","LOCKOUT","SUBMIT","CANCEL"].includes(r.type)?(i.activeMatch=Ss(i.activeMatch,r,o,l),(r.type==="START"||r.type==="ABORT")&&r.match&&(i.matchList=i.matchList.map(n=>n.shortName===r.match.shortName?{...n,start:r.match.start}:n))):r.type==="WAIT_FOR_INIT_SUBMIT"?i.waitForInitSubmit=r.waitForInitSubmit:console.log("Unknown message type "+r.type),{...s,[t]:i}}function Cs({field:s,fieldCount:r,event:o,hrControl:l}){const{isConnected:t,now:i,send:n}=Ue(`/stream/hr/?code=${o}&field=${s}`,w,E=>{E.send(JSON.stringify({type:"FETCH",field:s,first:!0}))}),[a,m]=C.useState("match"),[j,N]=C.useReducer((E,k)=>As(E,k,n,s),{}),[h,x]=ae("hrFlip"),[c,u]=ae("hrAutoOpen",0),[T,f]=ae("hrDcOpen",0),[O,I]=C.useState(!1),[p,g]=C.useState(),[A,L]=C.useState("match"),[F,v]=C.useState(),[U,R]=C.useState(ce()),H=j[window.division]||Be,{matchList:G,activeMatch:z,notes:J,meetingNotes:Z,timeouts:y,nextMatch:$,g301Start:b,waitForInitSubmit:D}=H;C.useEffect(()=>{document.documentElement.addEventListener("fullscreenchange",E=>R(ce())),document.documentElement.addEventListener("webkitfullscreenchange",E=>R(ce()))},[]);function w(E){E.match&&(E.match.redData=E.redData,E.match.blueData=E.blueData),N(E)}const W=(E,k="match",V={})=>{if(L(k),k==="match")g(E);else if(k==="team"||k==="teamWithCards"){const Q={team:V,notes:[]};for(let xe in E)E[xe].items.filter(le=>le.tags.includes(Q.team.number)).forEach(le=>Q.notes.push({match:xe,content:le.content,others:le.tags.filter(ve=>ve!==Q.team.number)}));v(Q)}I(!0)};return e.jsxs(e.Fragment,{children:[e.jsx(ns,{show:O&&A==="match",setShow:I,note:p,setNote:g,send:n,match:p?Es(G,p.match):void 0}),e.jsx(as,{show:O&&(A==="team"||A==="teamWithCards"),setShow:I,notes:F,noteList:J,showNote:W,send:n,matchList:G.filter(E=>{var k;return[...E.red,...E.blue].filter(V=>V).map(V=>V.number).includes(((k=F==null?void 0:F.team)==null?void 0:k.number)||-1)})}),e.jsxs("div",{className:"row",children:[e.jsx("a",{href:`/event/${o}/`,className:"col-4 text-left",children:d`<< Back`}),e.jsx("a",{href:"#",className:"col-4 text-center",onClick:()=>He(),children:U?"Exit Fullscreen":"Fullscreen"}),e.jsx("a",{href:"#",className:"col-4 text-right",onClick:()=>showHrHelp(),children:d`Help`})]}),e.jsx("div",{className:"row justify-content-center",children:e.jsxs("h2",{className:"col-12 text-center",children:[d`Head Referee`," ",r>1?`(${s==0?d`All Fields`:d`Field ${s}`})`:""]})}),t?null:e.jsx("div",{className:"alert alert-danger text-center h6",children:d`DISCONNECTED`}),e.jsx(De,{children:e.jsxs(ts,{defaultActiveKey:"match",activeKey:a,onSelect:E=>m(E||void 0),unmountOnExit:!1,children:[e.jsx(ee,{eventKey:"match",title:"Active Match",children:e.jsx(Ns,{activeMatch:z,notes:J,showNote:W,send:n,nowCallback:i,flip:h,setFlip:x,fullscreen:U,autoOpen:c,setAutoOpen:u,dcOpen:T,setDcOpen:f,waitForInitSubmit:D,fieldCount:r,field:s})}),l?e.jsx(ee,{eventKey:"control",title:e.jsx("div",{title:s!==0?"Not available on field-bound HR page.":"",style:{pointerEvents:"auto"},children:"Match Control"}),disabled:s!==0,children:e.jsx(gs,{eventCode:o,field:s,showMatchTab:()=>{m("match")}})}):null,e.jsx(ee,{eventKey:"notes",title:"Notes",children:e.jsx(ds,{notes:J,meetingNotes:Z,matchList:G,send:n,showNote:W})}),e.jsx(ee,{eventKey:"timing",title:"Timers",children:!window.isParent||G.length>0?e.jsx(hs,{activeMatch:z,matchList:G,timeouts:y,nextMatch:$,send:n,nowCallback:i,field:s}):e.jsx(ys,{divisionTimeoutData:j,divisionNames:window.divisions,nowCallback:i})}),e.jsx(ee,{eventKey:"scores",title:"Scoresheets",children:e.jsx(js,{matchLists:Object.fromEntries(Object.entries(j).map(([E,k])=>[E,k.matchList])),divisionNames:window.divisions})})]})})]})}const we=document.getElementById("headRefContent");we?$e.createRoot(we).render(e.jsx(De,{children:e.jsx(Cs,{field:window.field,event:window.eventCode,fieldCount:window.fieldCount,hrControl:window.hrControl})})):console.error("Mount point for head ref container not found");
//# sourceMappingURL=hr-DscWtK9b.js.map
