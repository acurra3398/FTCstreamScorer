import{j as e,t as i,r as j,c as C}from"../client-BvsFx6Uv.js";import{S as E}from"../StatusProgress-DfgH_RL1.js";import{P as M,u as T}from"../utils-CzBzcnQn.js";import{c as Q}from"../javaTypes-BFjjeUw7.js";import{p as R,c as B}from"../dialogs-Cji8mkGY.js";import{P as I,L}from"../index-vzWIEM6S.js";import{u as W}from"../utils-CzqY5F7f.js";import{B as v}from"../Button-CplEHJLM.js";import{E as _}from"../LocalErrorBoundary-B_5iy1c-.js";import{M as g}from"../Modal-BSxbHkAp.js";import"../merge-BCxs0UCa.js";import"../Form-C93KviTp.js";import"../index-CsyH6pUe.js";import"../all-crwlzFAZ.js";import"../warning-PI8mi4Hb.js";import"../createWithBsPrefix-Bt6Ige_C.js";import"../SafeAnchor-G5C8N4yQ.js";import"../exports-gx3CWV9A.js";import"../querySelectorAll-CV_V5nX6.js";try{let s=typeof window<"u"?window:typeof global<"u"?global:typeof globalThis<"u"?globalThis:typeof self<"u"?self:{},t=new s.Error().stack;t&&(s._sentryDebugIds=s._sentryDebugIds||{},s._sentryDebugIds[t]="ce718d18-300c-4faf-a32e-40811fc600e4",s._sentryDebugIdIdentifier="sentry-dbid-ce718d18-300c-4faf-a32e-40811fc600e4")}catch{}function O({statuses:s,value:t,team:l,form:a,eventCode:d,allowedStatuses:c}){return e.jsx("select",{value:t,onChange:async n=>{const r=n.target.value;await fetch(`/event/${d}/inspect/${a}/team/`,{method:"POST",body:M({form:a,team:l,status:r})})},children:s.filter(n=>c.includes(n.name)).map(n=>e.jsx("option",{value:n.name,children:n.displayName},n.name))})}function A({selectable:s,team:t,form:l,statuses:a,eventCode:d,allowedStatuses:c}){const n=t.statuses[l],r=a.find(h=>h.name==n);return e.jsxs("tr",{children:[e.jsx("td",{children:t.displayNumber}),e.jsx("td",{children:t.name}),e.jsx("td",{style:{backgroundColor:r==null?void 0:r.color,color:r!=null&&r.textWhite?"white":"black"},children:s?e.jsx(O,{statuses:a,value:n,team:t.number,form:l,eventCode:d,allowedStatuses:c}):r==null?void 0:r.displayName}),s?null:e.jsx("td",{children:e.jsx("a",{href:`${t.number}/`,children:i`Inspect`})})]})}function F({inspectionData:s,form:t,statusSelectable:l,eventCode:a,allowedStatuses:d}){if(!s)return null;const c=t=="robot"||t=="sizing";return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"row",children:[e.jsx("div",{className:"col-6",children:l?i`Set the status of each team:`:i`Select a team to inspect:`}),e.jsx("div",{className:"col-6 text-right",children:c?e.jsx("a",{href:"../../qr/alt/",className:"btn btn-sm btn-secondary",style:{marginBottom:"2px"},children:i`Alternate QR Scanning`}):null})]}),e.jsxs("table",{className:"table table-striped",style:{textAlign:"center",padding:"5px",width:"100%;"},children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:i`Team`}),e.jsx("th",{children:i`Name`}),e.jsx("th",{children:i`Status`}),l?null:e.jsx("th",{children:i`Inspect`})]})}),e.jsx("tbody",{children:s.teams.map(n=>e.jsx(A,{team:n,form:t,statuses:s.statuses,selectable:l,eventCode:a,allowedStatuses:d},n.number))})]})]})}function V({inspectionData:s,form:t,pitMapData:l,mapBb:a,statusSelectable:d,eventCode:c,allowedStatuses:n}){const r=j.useRef(),h=j.useRef(),[p,N]=W(`show-inspection-pitmap-${c}-${t}`,!0);return j.useEffect(()=>{var k,$;if(!l||!a)return;r.current=new I({id:"pitMapCanvas",pitColorCallback:w=>{var f;const u=h.current;if(!u)return["white","black"];const S=((f=u.teams.find(b=>b.number==w.team))==null?void 0:f.statuses[t])||Q.NONE,x=u.statuses.find(b=>b.name==S);return x?[x.color,x.textWhite?"white":"black"]:["white","black"]},minView:!0}),(k=r.current)==null||k.setPitLabelMode(L.TEAM),($=r.current)==null||$.setPitClickCallback(async w=>{var S,x;const u=(S=h.current)==null?void 0:S.teams.find(f=>f.number==w.team);if(u)if(d){const f=u.statuses[t],b=await R({label:i`Status for ${w.team}`,text:i`New status for ${u.number} - ${u.name}`,buttonText:i`Submit`,defaultValue:f,options:(x=h.current)==null?void 0:x.statuses.filter(y=>n.includes(y.name)).map(y=>e.jsx("option",{value:y.name,children:y.displayName},y.name))});b&&await fetch(`/event/${c}/inspect/${t}/team/`,{method:"POST",body:M({form:t,team:u.number,status:b})})}else await B({label:i`Inspect ${u.displayNumber}`,text:i`Ready to inspect ${u.displayNumber} - ${u.name}?`,buttonText:i`Inspect`})&&(window.location.href=`./${w.team}/`)});const o=document.getElementById("pitMapWrapper");let m=1;for(;o.clientWidth<a.w*I.BASE_CELL_SIZE*m&&m>.25;)m-=.1;m=Math.max(.25,m),r.current.setZoom(m),r.current.setData(l)},[l,a,d]),j.useEffect(()=>{var o;h.current=s,s&&r.current&&r.current.setDisplayTeamNumbers(Object.fromEntries(s.teams.map(m=>[m.number,m.displayNumber]))),(o=r.current)==null||o.draw()},[s]),l?e.jsxs("div",{id:"pitMapWrapper",className:"w-100 mt-2",style:{overflowX:"auto"},children:[e.jsxs(v,{className:"mb-1",variant:"secondary",size:"sm",onClick:()=>N(o=>!o),children:[p?"▼":"▶"," ",p?i`Hide Pit Map`:i`Show Pit Map`]}),e.jsx("div",{className:"ml-auto mr-auto",style:{width:"fit-content",display:p?void 0:"none"},children:e.jsx("canvas",{id:"pitMapCanvas",style:{position:"relative"}})})]}):e.jsx("div",{className:"mb-2"})}function z({form:s,inspectionData:t,showModal:l}){return!t||!(t!=null&&t.readyQueues[s])||t.readyQueues[s].length===0?null:e.jsx("div",{className:"row justify-content-center",children:e.jsxs("a",{href:"#",onClick:()=>l(),children:[t.readyQueues[s].length," Teams In Queue"]})})}function Z({form:s,inspectionData:t,show:l,hideModal:a,claim:d}){return!t||!(t!=null&&t.readyQueues[s])?null:e.jsxs(g,{show:l,children:[e.jsx(g.Header,{closeButton:!0,children:e.jsx(g.Title,{children:i`Team Queue`})}),e.jsx(g.Body,{children:t.readyQueues[s].length===0?e.jsx("i",{children:i`No teams in queue!`}):e.jsxs(e.Fragment,{children:[e.jsx("span",{children:i`Click "Claim" to take the team off the Queue and open their form. They will be set to "In Progress"`}),e.jsx("ol",{children:t.readyQueues[s].map(c=>{var n;return e.jsxs("li",{children:[c," - ",(n=t.teams.find(r=>r.number===c))==null?void 0:n.name,e.jsx(v,{size:"sm",style:{marginBottom:"10px",marginLeft:"10px"},onClick:()=>d(c),children:"Claim"})]},c)})})]})}),e.jsx(g.Footer,{children:e.jsx(v,{variant:"secondary",onClick:()=>a(),children:i`Close`})})]})}function q({eventCode:s,pitMapData:t,mapBb:l,form:a,statusSelectable:d,allowedStatuses:c}){const[n,r]=j.useState(),[h,p]=j.useState(!1),{isConnected:N}=T(`/stream/inspection/?code=${s}`,o=>{r(o)});return e.jsxs(e.Fragment,{children:[N?null:e.jsx("h3",{children:i`Disconnected`}),e.jsx(Z,{show:h,form:a,inspectionData:n,hideModal:()=>p(!1),claim:async o=>{(await fetch(`/event/${s}/inspect/${a}/team/`,{method:"POST",body:M({form:a,team:o,status:"IN_PROGRESS"})})).ok&&(window.location.href=`/event/${s}/inspect/${a}/${o}/`)}}),i`Legend:`,e.jsx("div",{className:"row ml-0 mr-0 mb-2 text-center",children:n==null?void 0:n.statuses.filter(o=>c.includes(o.name)).map(o=>e.jsx("div",{className:"col",style:{border:"1px solid black",backgroundColor:o.color,maxWidth:"125px",color:o.textWhite?"white":"black",whiteSpace:"nowrap"},children:o.displayName},o.name))}),n?e.jsx(E,{statusList:n.statuses,statusData:n.teams.map(o=>o.statuses[a])}):null,e.jsxs(_,{children:[e.jsx(V,{inspectionData:n,pitMapData:t,mapBb:l,form:a,statusSelectable:d,eventCode:s,allowedStatuses:c}),e.jsx(z,{form:a,inspectionData:n,showModal:()=>p(!0)})]}),e.jsx(F,{inspectionData:n,form:a,statusSelectable:d,eventCode:s,allowedStatuses:c})]})}const P=document.getElementById("inspectionStatusContainer");P?C.createRoot(P).render(e.jsx(q,{eventCode:window.eventCode,pitMapData:window.inspectionPitMapData,mapBb:window.inspectionMapBb,statusSelectable:window.inspectionStatusSelectable,form:window.form,allowedStatuses:window.allowedStatuses})):console.error("Mount point for inspection status container not found");
//# sourceMappingURL=teamSelect-B2QRqqsv.js.map
