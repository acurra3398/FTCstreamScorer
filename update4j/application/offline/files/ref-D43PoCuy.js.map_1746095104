{"version":3,"file":"ref-D43PoCuy.js","sources":["../../../../../../FTCCommon/src/main/javascript/ref/components/Toggle.tsx","../../../../../src/main/javascript/ref/TrainingBubble.tsx","../../../../../src/main/javascript/ref/Decode.tsx","../../../../../src/main/javascript/ref/MatchScoring.tsx","../../../../../src/main/javascript/ref/Timeout.tsx","../../../../../src/main/javascript/ref/Ref.tsx","../../../../../src/main/javascript/ref/index.tsx"],"sourcesContent":["import {ToggleButton, ToggleButtonGroup} from \"react-bootstrap\";\nimport {useUniqueId} from \"../../utils\";\nimport \"./Toggle.css\";\nimport {AllianceColor} from \"../../javaTypes\";\n\nexport default function Toggle({label, half, wide, value, setValue, disabled, options, color} : {\n    label?: string,\n    half?: boolean,\n    wide?: boolean,\n    value?: number,\n    setValue: (val: number) => void,\n    disabled?: boolean,\n    options: string[],\n    color?: AllianceColor,\n}) {\n    const id = useUniqueId();\n    return <>\n        {label ? <div className={`${wide ? 'col-12 col-sm-10' : `col-4 ${half ? '' : 'col-lg-2'}`} vertical-center mb-2`}>\n            {label}\n        </div> : null}\n        <ToggleButtonGroup className={`${wide ? 'col-12 col-sm-10' : `col-8 col-sm-6 ${half ? 'col-lg-6' : 'col-lg-3'}`} justify-content-center mb-2`}\n                           type=\"radio\" name={id} value={disabled ? -1 : value} onChange={setValue}>\n            {options.map((o, idx) => {\n                return <ToggleButton key={idx} value={idx} variant={`outline-${color?.toLowerCase() || 'info'}`} disabled={disabled} className={\"toggleButton\"}>\n                    {o}\n                </ToggleButton>\n            })}\n        </ToggleButtonGroup>\n    </>\n}\n\nexport function DependentToggle({label, dependentLabel, half, value, setValue, disabled, options, dependentOptions} : {\n    label: string,\n    dependentLabel: string,\n    half?: boolean,\n    value: number,\n    setValue: (val: number) => void,\n    disabled?: boolean,\n    options: string[],\n    dependentOptions: string[]\n}) {\n    const valTop = value === 0 ? 0 : Math.floor((value + 1) / 2)\n    const valBottom = value === 0 ? 0 : (value + 1) % 2\n    return <>\n        <Toggle label={label} half={half} value={valTop} setValue={(v) => setValue(v === 0 ? 0 : (v * 2) - 1 + valBottom)} options={options} disabled={disabled}/>\n        <Toggle label={dependentLabel} half={half} value={valBottom} setValue={(v) => setValue(v + (valTop * 2) - 1)} options={dependentOptions} disabled={value === 0 || disabled}/>\n    </>\n}\n","import { t } from \"ftc-common/i18n\";\nimport {ScoreType} from \"./Decode\";\nimport {RefMatch} from \"./Ref\";\nimport { CSSProperties, useEffect, useState } from \"react\";\n\nexport enum BubbleType {\n    TRAINING_INTRO,\n    INIT,\n    NO_SHOW,\n    SUBMIT_INIT,\n    WAIT_FOR_START,\n    RANDOMIZED,\n    AUTO,\n    AUTO_2,\n    AUTO_SAMPLES_SPECIMENS,\n    AUTO_LOCATION,\n    AUTO_FOULS,\n    AUTO_PATTERN,\n    AUTO_SUBMIT,\n    TELEOP,\n    TELEOP_ARTIFACT,\n    TELEOP_LOCATION,\n    TELEOP_DEPOT,\n    TELEOP_FOULS,\n    TELEOP_PATTERN,\n    TELEOP_END,\n    REVIEW,\n    NO_TRAINING\n}\n\nenum BubbleLocation {\n    TOP,\n    INLINE\n}\n\ninterface BubbleData {\n    location: BubbleLocation,\n    onClose?: Function,\n    isVisible?: (currentBubble: BubbleType, match?: RefMatch<ScoreType>) => boolean, // if the check is more complicated than just currentBubble == this\n    content: string,\n    classes?: string,\n    canGoBack?: boolean,\n    canGoForward?: (currentBubble: BubbleType, match? : RefMatch<ScoreType>) => boolean\n}\n\nfunction getBubbleContent(type : BubbleType) : string {\n    switch (type) {\n        case BubbleType.TRAINING_INTRO: return t`This Test Match has been marked as a Training Match. Informative bubbles will \n                step through the important parts of the scoring REFEREE workflow.`;\n        case BubbleType.INIT: return t`This is the Pre-MATCH Setup page. Enter information about the teams present. The color banner \n                should match the color of the ALLIANCE AREA nearest to you. On this page, you are entering the status of the teams in \n                the ALLIANCE AREA across from you. Their ROBOTS are on your side of the FIELD.`;\n        case BubbleType.NO_SHOW: return t`For each team, mark whether they are present for the MATCH. Per G208, the minimum requirement \n                to be \"Present\" is a DRIVE TEAM member. If a DRIVE TEAM member is in the ALLIANCE AREA but has no ROBOT, select \"No Robot.\"\n                If no DRIVE TEAM member is at the FIELD, mark the team as \"No Team.\" During playoffs, \"No Team\" will no longer be an option.`;\n        case BubbleType.SUBMIT_INIT: return t`After filling out this page, click the \"Alliance Ready\" button. If you need to edit these inputs,\n                you can return to this page until the end of AUTO.`;\n        case BubbleType.WAIT_FOR_START: return t`This is the Wait For MATCH Start page. It will automatically transition to AUTO when the MATCH starts.\n                Click the gray button if you need to return to the Pre-MATCH Setup page.`;\n        case BubbleType.AUTO: return t`This page is for recording AUTO scoring. After scoring AUTO, click the Submit button \n                to advance to the TELEOP screen. Even if you have questions about AUTO, submit what you can and move on so you don't miss achievements.\n                You can make edits to the AUTO scores in the Review screen following TELEOP.\n                The page will blink yellow if you have not advanced to TELEOP in time.<br/>\n                (For this Training Match, don't worry about the timing & yellow blinking.)`;\n        case BubbleType.AUTO_2: return t`For in-MATCH scoring, you are scoring achievements that occur on \n                your side of the FIELD. This will include achievements by both ALLIANCES. You are looking at the GOAL immediately adjacent to you and the ROBOTS that start on \n                your side of the FIELD, which should match the color of the inputs.`;\n        case BubbleType.AUTO_SAMPLES_SPECIMENS: return t`Use the top two inputs to record the number of ARTIFACTS that enter \n                the GOAL, exit under the archway, and pass through the SQUARE. If the ARTIFACT passes through the SQUARE and\n                transitions directly to the RAMP, count it as CLASSIFIED. If the ARTIFACT passes through the SQUARE but does \n                not directly transition to the RAMP, count it as OVERFLOW.` ;\n        case BubbleType.AUTO_LOCATION: return t`For each ROBOT that started on your half of the FIELD, check their location at the end of AUTO (approximately at the start of the buzzer). \n                To count for LEAVE points (mark as \"Yes\"), the ROBOT must be not be over any LAUNCH LINE (the lines of the white triangles \n                and the line at the base of the GOAL). Otherwise, mark them as \"No.\"`;\n        case BubbleType.AUTO_FOULS: return t`Enter any FOULS communicated to you by the gameplay REFEREE during the MATCH. FOUL counts are shared between \n                AUTO and TELEOP. You can enter FOULS for either ALLIANCE, but you will not see FOUL counts entered by other REFEREES. When entering a FOUL,\n                ensure you enter the correct FOUL type for the correct ALLIANCE.`\n        case BubbleType.AUTO_PATTERN: return t`As AUTO ends, ARTIFACTS on the RAMP contained by the GATE are recorded for PATTERN scoring.\n                Starting at the GATE (first input, nearest the bottom of the RAMP), record the color of each ARTIFACT directly on the RAMP\n                in the order they are on the RAMP by selecting either \"GREEN\" or \"PURPLE,\" regardless of how they got there. If only 5 \n                ARTIFACTS are on the RAMP, only 5 colors should be recorded, starting at the GATE. The rest (6-9) should remain with the default \"NONE\" (white circle).\n                `;\n        case BubbleType.AUTO_SUBMIT: return t`After scoring AUTO, click the Submit button to advance to the TELEOP screen. \n                Even if you have questions about AUTO, submit what you can and move on so you don't miss achievements.\n                You can make edits to the AUTO scores in the Review screen following TELEOP.`\n        // \"Field-state and\" remove\n        case BubbleType.TELEOP: return t`This page is for recording TELEOP scoring. FOUL counts have carried over from AUTO.`;\n        case BubbleType.TELEOP_ARTIFACT: return t`Continue to score OVERFLOW and CLASSIFIED ARTIFACTS. `;\n        case BubbleType.TELEOP_LOCATION: return t`At the end of the MATCH (T=0:00), look at the BASE ZONE near you. Record \n                if each of the ROBOTS has met fully or partially returned criteria. A fully returned ROBOT must be only supported, \n                either directly or transitively, by the BASE ZONE. A partially returned ROBOT must be partially supported either \n                directly or transitively, by the BASE ZONE.`\n        case BubbleType.TELEOP_DEPOT: return t`After the end of the MATCH, check the DEPOT nearest you and score the number of ARTIFACTS over the DEPOT line.`;\n        case BubbleType.TELEOP_FOULS: return t`Continue to add FOULS communicated to you by the gameplay REFEREE throughout the MATCH. \n                Ensure you enter the correct FOUL type for the correct ALLIANCE.`;\n        case BubbleType.TELEOP_PATTERN: return t`After the FIELD has come to rest, ARTIFACTS on the RAMP contained by the GATE are recorded for PATTERN scoring.\n                Starting at the GATE (first input, nearest the bottom of the RAMP), record the color of each ARTIFACT directly on the RAMP\n                in the order they are on the RAMP by selecting either \"GREEN\" or \"PURPLE,\" regardless of how they got there. If only 5 \n                ARTIFACTS are on the RAMP, only 5 colors should be recorded, starting at the GATE. The rest (6-9) should remain with the default \n                \"NONE\" (white circle).`;\n        case BubbleType.TELEOP_END: return t`Save any REFEREE discussions for the review phase, during which AUTO, TELEOP, and FOULS can be edited. Clicking \"Submit TELEOP\" \n                will transition to the Review page. If you have not submitted within 10 seconds, the page will flash yellow.`\n        case BubbleType.REVIEW: return t`The Review page lists the scores entered for both AUTO and TELEOP periods. Any edits \n                done here will not reflect in the live scores shown on the displays. Confirm with the gameplay REFEREE that you have recorded all the FOULS correctly.\n                Once you have finalized the scores, click \"Submit Final Scores.\" \n                Once you submit, only the scorekeeper can edit the scores.`\n    }\n    return \"Test\";\n}\n\nfunction getBubbleData(type : BubbleType) : BubbleData {\n    const content = getBubbleContent(type);\n    const toTrue = () => true;\n    switch (type) {\n        case BubbleType.TRAINING_INTRO: return {location: BubbleLocation.TOP, content: content, canGoForward: toTrue};\n        case BubbleType.INIT: return {location: BubbleLocation.TOP,  content: content, canGoBack: true, classes: \"small\", canGoForward: toTrue};\n        case BubbleType.NO_SHOW: return {location: BubbleLocation.INLINE,  content: content, canGoBack: true, classes:\"small\", canGoForward: toTrue};\n        case BubbleType.SUBMIT_INIT: return {location: BubbleLocation.INLINE,  content: content, canGoBack: true};\n        case BubbleType.WAIT_FOR_START: return {location: BubbleLocation.TOP,  content: content};\n        case BubbleType.AUTO: return {location: BubbleLocation.TOP,  content: content, canGoForward: toTrue, classes: \"small\", isVisible: currentBubble => currentBubble <= BubbleType.AUTO};\n        case BubbleType.AUTO_2: return {location: BubbleLocation.TOP,  content: content, canGoBack: true, canGoForward: toTrue};\n        case BubbleType.AUTO_SAMPLES_SPECIMENS: return {location: BubbleLocation.INLINE,  content: content, classes:\"small\", canGoBack: true, canGoForward: toTrue};\n        case BubbleType.AUTO_LOCATION: return {location: BubbleLocation.INLINE,  content: content, canGoBack: true, canGoForward: toTrue};\n        case BubbleType.AUTO_FOULS: return {location: BubbleLocation.INLINE,  content: content, canGoBack: true, canGoForward: toTrue};\n        case BubbleType.AUTO_PATTERN: return {location: BubbleLocation.INLINE,  content: content, canGoBack: true, classes: \"small\"};\n        case BubbleType.AUTO_SUBMIT: return {location: BubbleLocation.INLINE,  content: content, canGoBack: true};\n        case BubbleType.TELEOP: return {location: BubbleLocation.TOP,  content: content, canGoForward: toTrue, isVisible: currentBubble => currentBubble <= BubbleType.TELEOP};\n        case BubbleType.TELEOP_ARTIFACT: return {location: BubbleLocation.INLINE,  content: content, canGoBack: true, canGoForward: toTrue};\n        case BubbleType.TELEOP_DEPOT: return {location: BubbleLocation.INLINE,  content: content, canGoBack: true, canGoForward: toTrue};\n        case BubbleType.TELEOP_FOULS: return {location: BubbleLocation.INLINE,  content: content, canGoBack: true, canGoForward: toTrue};\n        case BubbleType.TELEOP_LOCATION: return {location: BubbleLocation.INLINE,  content: content, canGoBack: true, canGoForward: toTrue};\n        case BubbleType.TELEOP_PATTERN: return {location: BubbleLocation.INLINE,  content: content, canGoBack: true, canGoForward: toTrue, classes: \"small\"};\n        case BubbleType.TELEOP_END: return {location: BubbleLocation.INLINE,  content: content, classes: \"small\", canGoBack: true};\n        case BubbleType.REVIEW: return {location: BubbleLocation.TOP,  content: content, classes: \"small\", isVisible: currentBubble => currentBubble <= BubbleType.REVIEW};\n        default: return {location: BubbleLocation.INLINE, content: \"Error - Unknown Training Bubble!\"};\n    }\n}\n\nexport default function TrainingBubble({type, currentBubble, setCurrentBubble, match} : {\n    type: BubbleType,\n    currentBubble?: BubbleType,\n    setCurrentBubble?: (currentBubble : BubbleType) => void,\n    match?: RefMatch<ScoreType>\n}) {\n    const data = getBubbleData(type);\n\n    useEffect(() => {\n        const elem = document.getElementById(\"bubble_\" + type);\n        /*\n            Because this hook is called before the visibility check, it will also be called as it is being unmounted when currentBubble increments,\n            so elem may be null. This also allows it to work for the back button.\n         */\n        if (elem) {\n            elem.scrollIntoView({behavior: 'smooth'});\n        }\n    }, [type, currentBubble]);\n\n\n    if ((data.isVisible === undefined && currentBubble !== type) || (data.isVisible !== undefined && currentBubble !== undefined && !data.isVisible(currentBubble, match))) {\n        return null;\n    }\n    const isTop = data.location === BubbleLocation.TOP;\n    const style: CSSProperties = isTop ? {position: 'fixed', top: 0} : {position: 'absolute', bottom: 5, left: 15};\n    const hasNext = data.canGoForward !== undefined && currentBubble !== undefined && data.canGoForward(currentBubble, match);\n    const bubbleContent = <div id={\"bubble_\" + type} className={`bubble ${isTop ? \"container\" : \"\"} ${data.classes}`} style={style} >\n        <div dangerouslySetInnerHTML={{ '__html': data.content }}/>\n        <div className={\"w-100 text-center\"}>\n            {data.canGoBack ? <button className={\"btn btn-secondary btn-sm\"} onClick={setCurrentBubble ? () => setCurrentBubble(type - 1) : undefined}>{t`Back`}</button> : null}\n            <button className={\"btn btn-secondary btn-sm m-1 ml-4\"} onClick={setCurrentBubble ? () => setCurrentBubble(type + 1) : undefined}>{hasNext ? t`Next` : t`Close`}</button>\n        </div>\n    </div>\n\n    return isTop ? bubbleContent : <div className={\"bubbleWrap w-100\"} style={{position: 'relative'}}>{bubbleContent}</div>;\n}","import Counter from 'ftc-common/ref/components/Counter'\nimport Toggle from 'ftc-common/ref/components/Toggle'\nimport {DecodeScores} from \"../javaTypes\";\nimport {AllianceColor, ArtifactType} from \"ftc-common/javaTypes\";\nimport {Robots} from \"./MatchScoring\";\nimport TrainingBubble, {BubbleType} from \"./TrainingBubble\";\nimport {allianceToKey, MatchPhase, RefMatch} from \"./Ref\";\nimport {useId} from \"react\";\nimport './Decode.css'\nimport Artifact from \"../season/decode/Artifact\";\nimport {ReactSVG} from \"react-svg\";\nimport {useAsset} from \"ftc-common/AssetHelper\";\n\nexport type ScoreType = DecodeScores;\ntype ScoreTypeSetValue = <K extends keyof ScoreType>(color: AllianceColor, key: K, value: ScoreType[K]) => void\ntype AllianceScoreTypeSetValue = <K extends keyof ScoreType>(key: K, value: ScoreType[K]) => void\n\nfunction getNoShowString(score: DecodeScores, teamPos: 1 | 2, isElims: boolean ) {\n    if (isElims) {\n        return \"Not Playing\";\n    } else {\n        if (score[`noshow${teamPos}`] === 1) return \"No Team\";\n        if (score[`noshow${teamPos}`] === 2) return \"No Robot\";\n    }\n}\n\nconst classifierPositions = [1, 2, 3, 4, 5, 6, 7, 8, 9];\nconst colorCapsNames = {\n    [AllianceColor.RED]: 'Red',\n    [AllianceColor.BLUE]: 'Blue'\n}\n\nfunction replaceClassifierState(state: ArtifactType, position: number, existing: ArtifactType[]): ArtifactType[] {\n    const newState = [...existing];\n    if (position < 0 || position >= newState.length) {\n        throw new Error(`Invalid position ${position} for classifier state`);\n    }\n    newState[position] = state;\n    return newState;\n}\n\nfunction invalidArtifactIndexes(artifacts: ArtifactType[]) {\n    const indexes: number[] = [];\n    let foundNone = false;\n    artifacts.forEach((artifact, index) => {\n        if (artifact === ArtifactType.NONE) {\n            foundNone = true;\n        } else if (foundNone) {\n            indexes.push(index);\n        }\n    });\n    return indexes;\n}\n\nconst allianceColors = [AllianceColor.RED, AllianceColor.BLUE]\nconst robotArr = [1, 2] as const;\n\nexport const autoFields: Record<AllianceColor, Record<AllianceColor, (keyof ScoreType)[]>> = {\n    [AllianceColor.RED]: {\n        [AllianceColor.RED]: [],\n        [AllianceColor.BLUE]: [\"autoClassifiedArtifacts\", \"autoOverflowArtifacts\", \"autoClassifierState\", \"robot1Auto\", \"robot2Auto\"],\n    },\n    [AllianceColor.BLUE]: {\n        [AllianceColor.RED]: [\"autoClassifiedArtifacts\", \"autoOverflowArtifacts\", \"autoClassifierState\", \"robot1Auto\", \"robot2Auto\"],\n        [AllianceColor.BLUE]: [],\n    },\n}\n\nexport const teleopFields: Record<AllianceColor, Record<AllianceColor, (keyof ScoreType)[]>> = {\n    [AllianceColor.RED]: {\n        [AllianceColor.RED]: [\"robot1Teleop\", \"robot2Teleop\"],\n        [AllianceColor.BLUE]: [\"teleopClassifiedArtifacts\", \"teleopOverflowArtifacts\", \"teleopClassifierState\", \"teleopDepotArtifacts\"],\n    },\n    [AllianceColor.BLUE]: {\n        [AllianceColor.RED]: [\"teleopClassifiedArtifacts\", \"teleopOverflowArtifacts\", \"teleopClassifierState\", \"teleopDepotArtifacts\"],\n        [AllianceColor.BLUE]: [\"robot1Teleop\", \"robot2Teleop\"],\n    },\n}\n\nexport const penaltyFields: Record<AllianceColor, Record<AllianceColor, (keyof ScoreType)[]>> = {\n    [AllianceColor.RED]: {\n        [AllianceColor.RED]: [\"ownMajorFouls\", \"ownMinorFouls\"],\n        [AllianceColor.BLUE]: [\"otherMajorFouls\", \"otherMinorFouls\"],\n    },\n    [AllianceColor.BLUE]: {\n        [AllianceColor.RED]: [\"otherMajorFouls\", \"otherMinorFouls\"],\n        [AllianceColor.BLUE]: [\"ownMajorFouls\", \"ownMinorFouls\"],\n    },\n}\n\nfunction Classifier({ color, score, setScoreValue, field }: { color: AllianceColor, score: DecodeScores, setScoreValue: AllianceScoreTypeSetValue, field: 'autoClassifierState' | 'teleopClassifierState' }) {\n    const invalidIndexes = invalidArtifactIndexes(score[field]);\n    const idPrefix = useId();\n    const gateSvg = useAsset('img/decode/gate.svg');\n    return <>\n        <div className=\"form-group row justify-content-center\">\n            <table className={\"table table-bordered table-sm col-10 text-center classifier \"+color}>\n                <thead>\n                <tr>\n                    <th colSpan={5}>{colorCapsNames[color]} PATTERN Scoring</th>\n                </tr>\n                <tr>\n                    <th>GATE <ReactSVG src={gateSvg} className={\"d-inline-block\"}/></th>\n                    <th>GREEN</th>\n                    <th>PURPLE</th>\n                    <th>NONE</th>\n                    <th></th>\n                </tr>\n                </thead>\n                <tbody>\n                {classifierPositions.map((pos, idx) => <tr key={pos}\n                                                           className={invalidIndexes.includes(idx) ? 'table-danger' : ''}>\n                    <td>{pos}</td>\n                    {[ArtifactType.GREEN, ArtifactType.PURPLE, ArtifactType.NONE].map((type) => (\n                        <td key={type}>\n                            <div className=\"btn-group-toggle\" data-toggle=\"buttons\">\n                                <label\n                                    className={`btn btn-outline-secondary artifactLabel ` +\n                                               `${type.toString().toLowerCase()}-artifact ` +\n                                               `position-${pos} ` +\n                                               `${score[field][pos - 1] == type ? 'active' : ''}`}>\n                                    <input type=\"radio\" name={`${idPrefix}-${field}${pos}`}\n                                           checked={score[field][pos - 1] == type}\n                                           onChange={(e) => (e.target as HTMLInputElement).checked ? setScoreValue(field, replaceClassifierState(type, pos - 1, score[field])) : null}/>\n                                    <Artifact value={type}/>\n                                </label>\n                            </div>\n                        </td>))}\n                    <td style={{verticalAlign: \"middle\"}}>\n                        <div className={\"mx-auto\"} style={{width: 'fit-content'}}>\n                            <Artifact value={score[field][pos - 1]}/>\n                        </div>\n                    </td>\n                </tr>)}\n                </tbody>\n                <tfoot>\n                <tr>\n                    <th>SQUARE <i className={`far fa-fw fa-square`} style={{fontSize: '20px'}}></i></th>\n                    <th>GREEN</th>\n                    <th>PURPLE</th>\n                    <th>NONE</th>\n                    <th></th>\n                </tr>\n                </tfoot>\n            </table>\n        </div>\n    </>\n}\n\nexport function Init({scores, setupScores, setScoreValue, robots, alliance, isReview, currentBubble, setCurrentBubble, match} : {\n    scores: Record<AllianceColor, DecodeScores>,\n    setupScores: DecodeScores,\n    setScoreValue: ScoreTypeSetValue,\n    robots: Record<AllianceColor, Robots>,\n    alliance: AllianceColor,\n    isReview?: boolean,\n    currentBubble?: BubbleType,\n    setCurrentBubble?: (currentBubble : BubbleType) => void,\n    match: RefMatch<DecodeScores>\n}) {\n    const isElims = match.type === 'ELIMS';\n    const threeTeamAlliance = match[allianceToKey(alliance)].team3 > 0\n    // Convert between noshow value and the toggle order:\n    //      0 = present, 1 = no show, 2 = no robot (keep 0 & 1 the same as before to prevent unintended side-effects)\n    //      This means > 0 is a check for score validity (ie disabled if > 0), while == 1 if a check for no-show\n    //      These could be simplified but exploding the logic is easier to read.\n    const noshowToToggleValue = (v: number) => {\n        if (isElims) {\n            return v ? 0 : 1;\n        } else {\n            if (v === 2) return 1;\n            if (v === 1) return 0;\n            if (v === 0) return 2;\n        }\n    }\n    const toggleValueToNoshow = (v: number | undefined) => {\n        if (isElims) {\n            return v === 1 ? 0 : 1;\n        } else {\n            if (v === 0) return 1;\n            if (v === 1) return 2;\n            if (v === 2) return 0;\n        }\n    }\n    const teamString = alliance === AllianceColor.RED ? 'Red' : 'Blue';\n    return <>\n        <div className=\"form-group row justify-content-center\">\n            <div className={\"col-12 col-sm-10 col-lg-5 \"}>\n                <div className={\"initGroup text-center \"+alliance}>\n                    <div className={\"h3\"}>{teamString} Alliance Teams:</div>\n                    <br/>\n                    {[match[allianceToKey(alliance)].team1, match[allianceToKey(alliance)].team2, match[allianceToKey(alliance)].team3].map((t, idx) => [t, idx + 1] as [number, 1 | 2 | 3]).filter(t => t[0]).map(team => {\n                        const [t, teamPos] = team;\n                        const options = isElims ? [\"Not Playing\", \"On Field\"] : ['No Team', 'No Robot', 'Present'];\n                        return <div className=\"form-group row justify-content-center\" key={teamPos}>\n                            <Toggle label={`Team ${match[allianceToKey(alliance)][`team${teamPos}Display`]} Present:`} options={options} half={true}\n                                    value={noshowToToggleValue(setupScores[`noshow${teamPos}`])} color={alliance}\n                                    setValue={(val) => {\n                                        let noShowVal = toggleValueToNoshow(val) ?? 0;\n                                        setScoreValue(alliance, `noshow${teamPos}`, noShowVal);\n                                        if (!isElims) {\n                                            const qualsTeamPos = teamPos as 1 | 2; // can't have 3rd team in quals\n                                            setScoreValue(alliance, `dq${qualsTeamPos}`, noShowVal === 1 ? 1 : 0);\n                                        }\n                                    }}/>\n                        </div>\n                    })}\n                </div>\n            </div>\n        </div>\n    </>\n}\n\nexport function Auto({scores, setScoreValue, robots, alliance, isReview, currentBubble, setCurrentBubble, match} : {\n    scores: Record<AllianceColor, DecodeScores>,\n    setScoreValue: ScoreTypeSetValue,\n    robots: Record<AllianceColor, Robots>,\n    alliance: AllianceColor,\n    isReview?: boolean,\n    currentBubble?: BubbleType,\n    setCurrentBubble?: (currentBubble : BubbleType) => void,\n    match: RefMatch<DecodeScores>\n}) {\n    const myFields = autoFields[alliance]\n    for (const r of robotArr) {\n        for(const c of allianceColors) {\n            if (myFields[c].includes(`robot${r}Auto`) && !robots[c][`robot${r}`] && scores[c][`robot${r}Auto`] > 0) {\n                setScoreValue(c, `robot${r}Auto`, 0);\n            }\n        }\n    }\n    return <>\n        <TrainingBubble type={BubbleType.AUTO_SAMPLES_SPECIMENS} currentBubble={currentBubble} setCurrentBubble={setCurrentBubble}/>\n\n        <div className=\"form-group row justify-content-center\">\n            <div className={\"col-12 col-sm-10 col-lg-5 \"}>\n                {allianceColors.map(c =>\n                    myFields[c].includes(\"autoOverflowArtifacts\") ? <Counter key={c}\n                    label={`OVERFLOW ARTIFACTS`} color={c}\n                    limit={1000} large={true}\n                    value={scores[c].autoOverflowArtifacts}\n                    setValue={(val) => {\n                        setScoreValue(c, \"autoOverflowArtifacts\", val)\n                    }} /> : null)}\n\n                {allianceColors.map(c =>\n                    myFields[c].includes(\"autoClassifiedArtifacts\") ? <Counter key={c}\n                         label={`CLASSIFIED ARTIFACTS`} color={c} limit={1000}\n                         value={scores[c].autoClassifiedArtifacts} large={true}\n                         setValue={(val) => {\n                             setScoreValue(c, \"autoClassifiedArtifacts\", val)\n                         }}\n                /> : null)}\n            </div>\n        </div>\n\n        <TrainingBubble type={BubbleType.AUTO_LOCATION} currentBubble={currentBubble} setCurrentBubble={setCurrentBubble}/>\n        <div className=\"form-group row justify-content-center\">\n            {robotArr.map(num => allianceColors.map(c => myFields[c].includes(`robot${num}Auto`) ?\n                <Toggle key={`${num}-${c}`} color={c}\n                        label={`${colorCapsNames[c]} ${num} LEAVE (${robots[c][`robot${num}Display`] || getNoShowString(scores[c], num, match.type === \"ELIMS\")}):`}\n                        options={[\"No\", \"Yes\"]} value={scores[c][`robot${num}Auto`]}\n                        setValue={(val) => setScoreValue(c, `robot${num}Auto`, val)} disabled={!robots[c][`robot${num}`]} />\n                : null))}\n        </div>\n\n        <TrainingBubble type={BubbleType.AUTO_FOULS} currentBubble={currentBubble} setCurrentBubble={setCurrentBubble}/>\n        {isReview ? null : <Penalties scores={scores} setScoreValue={setScoreValue} alliance={alliance} />}\n\n        <TrainingBubble type={BubbleType.AUTO_PATTERN} currentBubble={currentBubble} setCurrentBubble={setCurrentBubble}/>\n        {allianceColors.map(c =>\n            myFields[c].includes(\"autoClassifierState\") ?\n                <Classifier key={c} color={c} score={scores[c]} setScoreValue={(field, value) => setScoreValue(c, field, value)}\n                            field={\"autoClassifierState\"}/> : null)}\n\n        <TrainingBubble type={BubbleType.AUTO_SUBMIT} currentBubble={currentBubble} setCurrentBubble={setCurrentBubble}/>\n    </>\n}\n\nexport function Teleop({ scores, setScoreValue, robots, alliance, currentBubble, setCurrentBubble, match, isReview }: {\n    scores: Record<AllianceColor, DecodeScores>,\n    setScoreValue: ScoreTypeSetValue,\n    robots: Record<AllianceColor, Robots>,\n    alliance: AllianceColor,\n    currentBubble?: BubbleType,\n    setCurrentBubble?: (currentType: BubbleType) => void,\n    match: RefMatch<DecodeScores>,\n    isReview?: boolean,\n}) {\n    const myFields = teleopFields[alliance]\n    return <>\n        <TrainingBubble type={BubbleType.TELEOP_ARTIFACT} currentBubble={currentBubble} setCurrentBubble={setCurrentBubble}/>\n        <div className=\"form-group row justify-content-center \">\n            <div className={\"col-12 col-sm-10 col-lg-5 \"}>\n                {allianceColors.map(c =>\n                    myFields[c].includes(\"teleopOverflowArtifacts\") ? <Counter key={c}\n                         label={`OVERFLOW ARTIFACTS`} color={c} limit={1000} large={true}\n                         value={scores[c].teleopOverflowArtifacts}\n                         setValue={(val) => {\n                             setScoreValue(c, \"teleopOverflowArtifacts\", val)\n                         }} /> : null)}\n\n                {allianceColors.map(c =>\n                    myFields[c].includes(\"teleopClassifiedArtifacts\") ? <Counter key={c}\n                         label={`CLASSIFIED ARTIFACTS`} color={c} limit={1000} large={true}\n                         value={scores[c].teleopClassifiedArtifacts}\n                         setValue={(val) => {\n                             setScoreValue(c, \"teleopClassifiedArtifacts\", val)\n                         }} />: null)}\n            </div>\n        </div>\n\n        <TrainingBubble type={BubbleType.TELEOP_LOCATION} currentBubble={currentBubble} setCurrentBubble={setCurrentBubble}/>\n        <div className=\"form-group row justify-content-center\">\n            {robotArr.map(num => allianceColors.map(c => myFields[c].includes(`robot${num}Teleop`) ?\n                <Toggle key={`${num}-${c}`} color={c}\n                        label={`${colorCapsNames[c]} ${num} BASE (${robots[c][`robot${num}Display`] || getNoShowString(scores[c], num, match.type === \"ELIMS\")}):`}\n                        options={[\"No\", \"Partial\", \"Full\"]} value={scores[c][`robot${num}Teleop`]}\n                        setValue={(val) => setScoreValue(c, `robot${num}Teleop`, val)} disabled={!robots[c][`robot${num}`]} />\n                : null))}\n        </div>\n\n        <TrainingBubble type={BubbleType.TELEOP_DEPOT} currentBubble={currentBubble} setCurrentBubble={setCurrentBubble}/>\n        <div className=\"form-group row justify-content-center\">\n            <div className={\"col-12 col-sm-10 col-lg-5 \"}>\n                {allianceColors.map(c =>\n                    myFields[c].includes(\"teleopDepotArtifacts\") ? <Counter  key={c}\n                         label={`DEPOT ARTIFACTS`} color={c} limit={1000}\n                         value={scores[c].teleopDepotArtifacts}\n                         setValue={(val) => {\n                             setScoreValue(c, \"teleopDepotArtifacts\", val)\n                         }} /> : null)}\n            </div>\n        </div>\n\n        <TrainingBubble type={BubbleType.TELEOP_FOULS} currentBubble={currentBubble} setCurrentBubble={setCurrentBubble}/>\n        {isReview ? null : <Penalties scores={scores} setScoreValue={setScoreValue} alliance={alliance} />}\n\n\n        <TrainingBubble type={BubbleType.TELEOP_PATTERN} currentBubble={currentBubble} setCurrentBubble={setCurrentBubble}/>\n        {allianceColors.map(c =>\n            myFields[c].includes(\"teleopClassifierState\") ?\n                <Classifier key={c} color={c} score={scores[c]} setScoreValue={(field, value) => setScoreValue(c, field, value)}\n                            field={\"teleopClassifierState\"}/> : null)}\n        <hr/>\n    </>\n}\n\nexport function Penalties({scores, setScoreValue, alliance}: {\n    scores: Record<AllianceColor, DecodeScores>,\n    setScoreValue: ScoreTypeSetValue,\n    alliance: AllianceColor\n}) {\n    const myFields = penaltyFields[alliance]\n    return <>\n        <div className=\"form-group row justify-content-center\">\n            {allianceColors.map(c => <div className={`col-12 col-sm-10 col-lg-5 penalties penalties-${c}`} key={c}>\n                <span>{c == AllianceColor.RED ? 'Red FOULS' : 'Blue FOULS'}</span>\n                {(['ownMinorFouls', 'otherMinorFouls'] as const).map(field => myFields[c].includes(field) ?\n                    <Counter key={field} label={\"MINOR:\"} color={c}\n                             value={scores[c][field]} setValue={(val) => setScoreValue(c, field, val)} /> : null)}\n                {(['ownMajorFouls', 'otherMajorFouls'] as const).map(field => myFields[c].includes(field) ?\n                    <Counter key={field} label={\"MAJOR:\"} color={c}\n                             value={scores[c][field]} setValue={(val) => setScoreValue(c, field, val)} /> : null)}\n            </div>)}\n        </div>\n    </>\n}\n\nexport function validationErrors(\n    scores: Record<AllianceColor, DecodeScores>,\n    phase: MatchPhase,\n    alliance: AllianceColor\n) {\n    const errors = []\n    for(const c of allianceColors) {\n        let fields: (keyof ScoreType)[] = [];\n        if (phase == MatchPhase.AUTO) {\n            fields = autoFields[alliance][c];\n        } else if (phase == MatchPhase.TELEOP) {\n            fields = teleopFields[alliance][c];\n        } else if (phase == MatchPhase.REVIEW) {\n            fields = [...autoFields[alliance][c], ...teleopFields[alliance][c], ...penaltyFields[alliance][c]];\n        }\n        const currentScores = scores[c];\n        for (const field of fields) {\n            if(typeof currentScores[field] == 'number' && currentScores[field] < 0) {\n                errors.push(`Negative value for $[c} - ${field} alliance`);\n            }\n            if(field == 'autoClassifierState' || field == 'teleopClassifierState') {\n                if(invalidArtifactIndexes(currentScores[field]).length > 0) {\n                    errors.push(`Artifacts must be contiguous in the ${field.replace('ClassifierState', '')} classifier`);\n                }\n            }\n        }\n    }\n    return errors;\n}","import {useEffect, useRef, useState} from \"react\";\nimport Toggle from \"ftc-common/ref/components/Toggle\";\nimport {Auto, autoFields, validationErrors, Penalties, penaltyFields, ScoreType, Teleop, teleopFields, Init} from \"./Decode\";\nimport {MatchType, RefMessage, RefMessageType, Scores} from \"../javaTypes\";\nimport {AllianceColor, ArtifactType} from \"ftc-common/javaTypes\";\nimport {t} from \"ftc-common/i18n\";\nimport {allianceToKey, MatchPhase, RefMatch, RefUpdateResponsePayload} from \"./Ref\";\n\nimport './MatchScoring.css';\nimport TrainingBubble, {BubbleType} from \"./TrainingBubble\";\nimport {useAsset} from \"ftc-common/AssetHelper\";\nimport { ReactSVG } from \"react-svg\";\nimport {useStateRef} from \"../util\";\nimport Artifact, {randomizationArtifacts} from \"../season/decode/Artifact\";\n\nexport type Robots =  { robot1: number, robot1Display: string, robot2: number, robot2Display: string };\n\nfunction getNoShowString(scores: ScoreType, teamPos: 1 | 2 | 3, isPlayoff: boolean) {\n    if (!scores[`noshow${teamPos}`]) {\n        return \"\"; //\n    }\n    if (scores[`noshow${teamPos}`] === 1 && !isPlayoff) return \"No Show\";\n    if (scores[`noshow${teamPos}`] === 2 || isPlayoff) return \"No Robot\";\n}\n\nfunction hasNoRobot(scores: ScoreType, teamPos: 1 | 2 | 3) {\n    return scores[`noshow${teamPos}`] > 0;\n}\n\nfunction ShowRandomization({alliance, randomization} : {\n    alliance : AllianceColor,\n    randomization: number,\n}) {\n    const artifacts = randomizationArtifacts[randomization];\n\n    return <div className={`form-group row justify-content-center`}>\n        <div className=\"col-12 text-center\"><b>Randomization:</b></div>\n        <div className=\"col-12 text-center\">\n            <div className={\"randomizationWrapper\"}>\n                <div className={\"artifacts\"}>\n                    {artifacts?.map((artifact, index) => (\n                        <Artifact key={index} value={artifact} />\n                    ))}\n                </div>\n            </div>\n        </div>\n        <div className={\"col-12 text-center\"}>\n            <span className={\"positionSpan\"}>MOTIF {randomization} (ID 2{randomization})</span>\n        </div>\n    </div>;\n}\n\nexport default function MatchScoring({alliance, match, phase, sendMessage} : {\n    alliance: AllianceColor,\n    match: RefMatch<ScoreType>,\n    phase: MatchPhase,\n    sendMessage: (msg : Omit<RefMessage, \"id\">) => Promise<RefUpdateResponsePayload>\n}) {\n    const [currentRedScores, setRedScores, currentRedScoresRef] = useStateRef(match.red.scores);\n    const [currentBlueScores, setBlueScores, currentBlueScoresRef] = useStateRef(match.blue.scores);\n    const prevMatchRef = useRef<RefMatch<ScoreType>>();\n    const [errorMessage, setErrorMessage] = useState<string | null>(null);\n    const [currentBubble, setCurrentBubble] = useState<BubbleType>(match.training ? BubbleType.TRAINING_INTRO : BubbleType.NO_TRAINING);\n\n    useEffect(() => {\n        if(!prevMatchRef.current || prevMatchRef.current.type !== match.type || prevMatchRef.current.number !== match.number || prevMatchRef.current?.abortedAt !== match.abortedAt) {\n            setRedScores(match.red.scores);\n            setBlueScores(match.blue.scores);\n        }\n        prevMatchRef.current = match\n    }, [alliance, match]);\n\n    async function sendScores(type : RefMessageType, newScores?: { scores : ScoreType, color: AllianceColor }) {\n        setErrorMessage(null)\n        const redScores = (newScores && newScores.color == AllianceColor.RED ? newScores.scores : currentRedScoresRef.current!);\n        const blueScores = (newScores && newScores.color == AllianceColor.BLUE ? newScores.scores : currentBlueScoresRef.current!);\n\n        const filterRedFields = [...autoFields[alliance].RED, ...teleopFields[alliance].RED, ...penaltyFields[alliance].RED]\n        const filterBlueFields = [...autoFields[alliance].BLUE, ...teleopFields[alliance].BLUE, ...penaltyFields[alliance].BLUE]\n        const target = alliance == AllianceColor.RED ? filterBlueFields : filterRedFields;\n        for(const num of [1, 2, 3] as const) {\n            target.push(`noshow${num}`);\n        }\n        for(const num of [1, 2] as const) {\n            target.push(`dq${num}`);\n        }\n\n        const partialRedScores = Object.fromEntries(\n            Object.entries(redScores).filter(\n                ([key, val])=> (filterRedFields).includes(key as keyof ScoreType)\n            )\n        )\n        const partialBlueScores = Object.fromEntries(\n            Object.entries(blueScores).filter(\n                ([key, val])=> (filterBlueFields).includes(key as keyof ScoreType)\n            )\n        )\n        const res = await sendMessage({type: type, match: match.number,\n            redScoreUpdateString: JSON.stringify(partialRedScores),\n            blueScoreUpdateString: JSON.stringify(partialBlueScores)\n        })\n        if(res.status !== 'SUCCESS') {\n            setErrorMessage(res.message || null)\n            setTimeout(() => setErrorMessage(null), type == RefMessageType.SUBMIT_MATCH ? 10000 : 3000)\n            return false;\n        }\n        return true;\n    }\n\n    function setScoreValue<K extends keyof ScoreType>(alliance: AllianceColor, key: K, value: ScoreType[K]) {\n        const func = alliance === AllianceColor.RED ? setRedScores : setBlueScores;\n        func((was : ScoreType) => {\n            const newScores = Object.assign<{}, ScoreType, Partial<ScoreType>>({}, was, {[key]: value})\n\n            if(phase === MatchPhase.REVIEW) {\n                sendScores(RefMessageType.QUIET_SCORE_UPDATE, { color: alliance, scores: newScores })\n            } else {\n                sendScores(RefMessageType.SCORE_UPDATE, { color: alliance, scores: newScores })\n            }\n            return newScores;\n        })\n    }\n\n    function calculateRobots(ns1 : number, ns2 : number, ns3 : number, alliance : AllianceColor) {\n        const tempRobots : Robots = { robot1: 0, robot1Display: '', robot2: 0, robot2Display: '' };\n        if (match.type === 'ELIMS') {\n            const allTeams = [\n                ns1 ? null : [match[allianceToKey(alliance)].team1, match[allianceToKey(alliance)].team1Display],\n                ns2 ? null : [match[allianceToKey(alliance)].team2, match[allianceToKey(alliance)].team2Display],\n                ns3 ? null : [match[allianceToKey(alliance)].team3, match[allianceToKey(alliance)].team3Display]\n            ].filter(t => t) as [number, string][];\n            const team1 = allTeams[0] || [0, ''];\n            const team2 = allTeams[1] || [0, ''];\n            tempRobots.robot1 = team1[0];\n            tempRobots.robot2 = team2[0];\n            tempRobots.robot1Display = team1[1];\n            tempRobots.robot2Display = team2[1];\n        } else {\n            tempRobots.robot1 = ns1 ? 0 : match[allianceToKey(alliance)].team1;\n            tempRobots.robot2 = ns2 ? 0 : match[allianceToKey(alliance)].team2;\n            tempRobots.robot1Display = ns1 ? '' : match[allianceToKey(alliance)].team1Display;\n            tempRobots.robot2Display = ns2 ? '' : match[allianceToKey(alliance)].team2Display;\n        }\n        return tempRobots;\n    }\n\n    const redRobots = calculateRobots(currentRedScores.noshow1, currentRedScores.noshow2, currentRedScores.noshow3, AllianceColor.RED);\n    const blueRobots = calculateRobots(currentBlueScores.noshow1, currentBlueScores.noshow2, currentBlueScores.noshow3, AllianceColor.BLUE);\n\n    const preloadTarget = ((match.randomization - 1) % 3) + 1;\n\n    const submitPhaseAndScroll = async (phase : RefMessageType) => {\n        if (await sendScores(phase)) {\n            window.scrollTo(0, 0);\n        }\n    }\n\n    const scoreProps = {\n        scores: {\n            [AllianceColor.RED]: currentRedScores,\n            [AllianceColor.BLUE]: currentBlueScores\n        },\n        alliance,\n        robots: {\n            [AllianceColor.RED]: redRobots,\n            [AllianceColor.BLUE]: blueRobots\n        },\n        preloadTarget,\n        setScoreValue,\n        match\n    }\n\n    const invalidMessages = validationErrors(scoreProps.scores, phase, alliance)\n    const errorDisplay = <div className=\"col-10 text-center\">\n        {invalidMessages.join(\". \")}\n        {errorMessage}\n    </div>\n\n    // for Decode, the ref does init for the opposite alliance\n    const initAlliance= alliance == AllianceColor.RED ? AllianceColor.BLUE : AllianceColor.RED;\n    const initDisplayColor = initAlliance === AllianceColor.RED ? 'Red' : 'Blue';\n    const setupScores = initAlliance == AllianceColor.RED ? currentRedScores : currentBlueScores;\n    switch (phase) {\n        case MatchPhase.SETUP:\n            return <div>\n                <TrainingBubble type={BubbleType.TRAINING_INTRO} currentBubble={currentBubble} setCurrentBubble={setCurrentBubble}/>\n                <TrainingBubble type={BubbleType.INIT} currentBubble={currentBubble} setCurrentBubble={setCurrentBubble}/>\n                <TrainingBubble type={BubbleType.NO_SHOW} currentBubble={currentBubble} setCurrentBubble={setCurrentBubble}/>\n                <Init match={scoreProps.match} scores={scoreProps.scores} robots={scoreProps.robots} alliance={initAlliance} isReview setupScores={setupScores} setScoreValue={scoreProps.setScoreValue}/>\n                <hr/>\n                <TrainingBubble type={BubbleType.SUBMIT_INIT} currentBubble={currentBubble} setCurrentBubble={setCurrentBubble}/>\n                <div className=\"row justify-content-center\">\n                    <button className=\"btn col-6 text-center btn-secondary\" onClick={() => sendScores(RefMessageType.SUBMIT_INIT)}\n                            disabled={!(match[allianceToKey(initAlliance)].team3 > 0 || [setupScores.noshow1, setupScores.noshow2, setupScores.noshow3].some(ns => ns > 0))}>\n                        {t`${initDisplayColor} Alliance Ready`}\n                    </button>\n                    {errorDisplay}\n                </div>\n            </div>\n        case MatchPhase.WAIT:\n            return <div>\n                <TrainingBubble type={BubbleType.WAIT_FOR_START} currentBubble={currentBubble} setCurrentBubble={setCurrentBubble} match={match}/>\n                <div className=\"form-group row justify-content-center\">\n                    <div\n                        className=\"col-10\">{t`Waiting for match to start. This page will automatically load when the match has started.`}</div>\n                </div>\n                <div className=\"row justify-content-center\">\n                    <h3 className=\"col-10\">{t`Waiting for Match ${match.shortName}`}</h3>\n                </div>\n                <br/>\n                <div className=\"row justify-content-center text-center\">\n                    <table className={\"w-100 waitingTeamsTable \"+initAlliance}>\n                        <tbody>\n                           <tr className={\"h3\"}>\n                               <td colSpan={match[allianceToKey(initAlliance)].team3 > 0 ? 3: 2} className={\"text-center\"}>{initDisplayColor} Alliance Teams:</td>\n                           </tr>\n                            <tr className=\"h3\">\n                                <td>\n                                    {match[allianceToKey(initAlliance)].team1Display}\n                                </td>\n                                <td>\n                                    {match[allianceToKey(initAlliance)].team2Display}\n                                </td>\n                                {match[allianceToKey(initAlliance)].team3 > 0 ? <td>\n                                    {match[allianceToKey(initAlliance)].team3Display}\n                                </td> : null}\n                            </tr>\n                            <tr>\n                                <td>\n                                    {hasNoRobot(setupScores, 1) ? <span className=\"noShow\">{getNoShowString(setupScores, 1, match.type == MatchType.ELIMS)}</span> : null}\n                                </td>\n                                <td>\n                                    {hasNoRobot(setupScores, 2) ? <span className=\"noShow\">{getNoShowString(setupScores, 2, match.type == MatchType.ELIMS)}</span> : null}\n                                </td>\n                                {match[allianceToKey(initAlliance)].team3 > 0 ? <td>\n                                    {hasNoRobot(setupScores, 3) ? <span className=\"noShow\">{getNoShowString(setupScores, 3, match.type == MatchType.ELIMS)}</span> : null}\n                                </td> : null}\n                            </tr>\n                        </tbody>\n                    </table>\n                </div>\n                <br/>\n                <div className=\"row justify-content-center\">\n                    <button className=\"btn col-6 text-center btn-secondary\" onClick={() => sendScores(RefMessageType.UNSUBMIT_INIT)}>\n                        Edit Pre-Match Setup\n                    </button>\n                </div>\n                <br/><br/>\n                {/*<TrainingBubble type={BubbleType.RANDOMIZED} currentBubble={currentBubble} setCurrentBubble={setCurrentBubble} match={match}/>*/}\n                {match.randomization < 0 ? <div className=\"row justify-content-center\">\n                    <div className=\"col-10\">Match has not been randomized. This page will update once the randomization\n                        has been decided\n                    </div>\n                </div> : <ShowRandomization alliance={alliance} randomization={match.randomization}/> }\n            </div>\n        case MatchPhase.AUTO:\n            return <div>\n                <TrainingBubble type={BubbleType.AUTO} currentBubble={currentBubble} setCurrentBubble={setCurrentBubble}/>\n                <TrainingBubble type={BubbleType.AUTO_2} currentBubble={currentBubble} setCurrentBubble={setCurrentBubble}/>\n                <div className=\"row justify-content-center\">\n                    <button className=\"btn col-6 text-center btn-secondary mb-2\" onClick={() => sendScores(RefMessageType.UNSUBMIT_INIT)}>\n                        Edit Pre-Match Setup\n                    </button>\n                </div>\n                <Auto {...scoreProps} currentBubble={currentBubble} setCurrentBubble={setCurrentBubble} />\n                <div className=\"row justify-content-center\">\n                    <button className=\"btn col-6 text-center btn-secondary\"  onClick={() => submitPhaseAndScroll(RefMessageType.SUBMIT_AUTO)}\n                            disabled={invalidMessages.length > 0}>\n                        {t`Submit AUTO`}\n                    </button>\n                    {errorDisplay}\n                </div>\n            </div>\n        case MatchPhase.TELEOP:\n            return <div>\n                <TrainingBubble type={BubbleType.TELEOP} currentBubble={currentBubble} setCurrentBubble={setCurrentBubble}/>\n                <Teleop {...scoreProps} currentBubble={currentBubble} setCurrentBubble={setCurrentBubble} />\n                <TrainingBubble type={BubbleType.TELEOP_END} currentBubble={currentBubble} setCurrentBubble={setCurrentBubble}/>\n                <div className=\"row justify-content-center\">\n                    <button className=\"btn col-6 text-center btn-secondary\"  onClick={() => submitPhaseAndScroll(RefMessageType.SUBMIT_TELEOP)}\n                            disabled={invalidMessages.length > 0}>\n                        {t`Submit TELEOP`}\n                    </button>\n                    {errorDisplay}\n                </div>\n            </div>\n        case MatchPhase.REVIEW:\n            return <div>\n                <TrainingBubble type={BubbleType.REVIEW} currentBubble={currentBubble} setCurrentBubble={setCurrentBubble}/>\n                <div className=\"row justify-content-center\">\n                    <div className=\"col-10 alert alert-dark text-center\">\n                        Pre-MATCH\n                    </div>\n                </div>\n                <Init match={scoreProps.match} scores={scoreProps.scores} robots={scoreProps.robots} alliance={initAlliance} isReview setupScores={setupScores} setScoreValue={scoreProps.setScoreValue}/>\n                <div className=\"row justify-content-center\">\n                    <div className=\"col-10 alert alert-dark text-center\">\n                        AUTO Scores\n                    </div>\n                </div>\n                <Auto {...scoreProps} isReview />\n                <div className=\"row justify-content-center\">\n                    <div className=\"col-10 alert alert-dark text-center\">\n                        TELEOP Scores\n                    </div>\n                </div>\n                <Teleop {...scoreProps} isReview />\n                <Penalties {...scoreProps} />\n                <div className=\"row justify-content-center\">\n                    <button className=\"btn col-6 text-center btn-secondary\"  onClick={() => sendScores(RefMessageType.SUBMIT_MATCH)}\n                            disabled={invalidMessages.length > 0}>\n                        {t`Submit Final Scores`}\n                    </button>\n                    {errorDisplay}\n                </div>\n            </div>\n    }\n    return <>unknown phase</>;\n}","import {MatchPhase, RefMatch} from \"./Ref\";\nimport {ScoreType} from \"./PowerPlay\";\nimport {TimeoutReference} from \"ftc-common/javaTypes\";\nimport {useCallback, useEffect, useState} from \"react\";\nimport {useTimer} from \"ftc-common/hooks\";\nimport {disableFullscreen, enableFullscreen, isFullScreen, renderTime, toggleFullscreen} from \"ftc-common/utils\";\nimport { t } from \"ftc-common/i18n\";\nimport {isEqual} from \"lodash\";\n\nimport './Timeout.css';\nimport {TimeoutUpdate} from \"../javaTypes\";\nimport {isG301Timeout} from \"ftc-common/timeoutUtils\";\n\n/*\n * 3 timeout displays - single TO center banner, double-TO corners, full-screen single\n *      1 field event or unbound (SF only) -> corner -> same logic as display ignore\n *      F/bound -> single banner\n *\n * If match (init/WFS), show single\n */\n\nexport default function Timeout({timeoutUpdate, match, phase, field, fieldCount, nowCallback, isConnected} : {\n    timeoutUpdate? : TimeoutUpdate,\n    match?: RefMatch<ScoreType>,\n    phase: MatchPhase,\n    field: number,\n    fieldCount: number,\n    nowCallback : () => number,\n    isConnected: boolean\n}) {\n    const [fullscreen, setFullscreen] = useState<boolean>(false);\n    const [selectedTimer, setSelectedTimer] = useState<TimeoutReference>();\n    const clear = useCallback(() => {\n        setFullscreen(false);\n        setSelectedTimer(undefined);\n    }, [setFullscreen, setSelectedTimer])\n    const fullscreenChange = useCallback((e : Event) => {\n        if (!isFullScreen()) {\n            clear();\n        }\n    }, [clear])\n    useEffect(() => {\n        document.documentElement.addEventListener(\"fullscreenchange\", fullscreenChange);\n        return () => {\n            document.documentElement.removeEventListener(\"fullscreenchange\", fullscreenChange);\n        }\n    }, [fullscreenChange]);\n    useEffect(() => {\n        // If a timeout ends while in fullscreen or we are forced out of fullscreen, clear the selected timer & fullscreen flag\n        if (!timeoutUpdate?.timeouts.some(x => isEqual(x, selectedTimer)) || !fullscreen) {\n            disableFullscreen().then(() => clear());\n        }\n    }, [fullscreen, timeoutUpdate, selectedTimer]);\n\n    const bigTimer = (timeout: TimeoutReference) => document.getElementById(\"bigTimer\")?.requestFullscreen().then(() => {\n        setSelectedTimer(timeout);\n        setFullscreen(true);\n    });\n\n    const g301Timeout = timeoutUpdate?.timeouts.find(isG301Timeout);\n    if (g301Timeout) {\n        return <SingleTimeout singleTimeout={g301Timeout} nowCallback={nowCallback} bigTimer={bigTimer} fullscreen={fullscreen}\n                              clear={clear} selectedTimer={selectedTimer} timeoutUpdate={timeoutUpdate} isConnected={isConnected}/>\n    } else {\n        // TODO\n        return null;\n    }\n    // const leftTimeout : TimeoutReference | undefined = undefined; //timeoutUpdate?.timeouts.find(to => to?.series !== 2);\n    // const rightTimeout : TimeoutReference | undefined = undefined; //timeoutUpdate?.timeouts.find(to => to?.series === 2);\n    // if (!leftTimeout && !rightTimeout) {\n    //     return null;\n    // }\n    //\n    // let singleTimeout : TimeoutReference | undefined = timeoutUpdate?.timeouts.find(to => to.field === 0 || to.field === field);\n    // if ((leftTimeout?.isElims ?? true) && (field === 0 || fieldCount === 1) && leftTimeout?.field !== 0) {\n    //     // SF: during match select/lockout, if unbound or 1-field event, show corner times unless it is a finals TO (or pseudo-finals)\n    //     if (phase === MatchPhase.SELECT || phase === MatchPhase.LOCKOUT) {\n    //         // TODO if not fullscreen - for FS, need to set which timer is the FS timer. Tap for FS?\n    //         return <>\n    //             <div className={\"timeout row pb-2\"}>\n    //                 <CornerTimeout nowCallback={nowCallback} timeout={leftTimeout} setBigTimer={bigTimer}/>\n    //                 <div className={\"col-4 text-sm text-center font-italic\"}>{t`Tap timer to fullscreen`}</div>\n    //                 <CornerTimeout nowCallback={nowCallback} timeout={rightTimeout} setBigTimer={bigTimer}/>\n    //             </div>\n    //             <BigTimer nowCallback={nowCallback} timeout={selectedTimer} show={fullscreen} exitFullscreen={clear} isConnected={isConnected}/>\n    //         </>\n    //     } else if (phase === MatchPhase.SETUP || phase === MatchPhase.WAIT) {\n    //         // once in a match screen, pick the timeout that matches the match and single banner it\n    //         singleTimeout = timeoutUpdate?.timeouts.find(to => to.field === 0 || to.series === parseInt(match?.shortName[2] ?? \"0\") );\n    //     }\n    // }\n    // if (!singleTimeout || singleTimeout?.timeoutStart === 0) {\n    //     return null;\n    // }\n    // return <SingleTimeout singleTimeout={singleTimeout} nowCallback={nowCallback} bigTimer={bigTimer} fullscreen={fullscreen} clear={clear} selectedTimer={selectedTimer} timeoutUpdate={timeoutUpdate} isConnected={isConnected}/>\n}\n\nfunction SingleTimeout({ singleTimeout, nowCallback, bigTimer, selectedTimer, fullscreen, timeoutUpdate, clear, isConnected}: {\n    bigTimer: (timeout: TimeoutReference) => Promise<void> | undefined,\n    fullscreen: boolean,\n    clear: () => void,\n    isConnected: boolean,\n    nowCallback: () => number,\n    timeoutUpdate?: TimeoutUpdate,\n    selectedTimer: TimeoutReference | undefined,\n    singleTimeout: TimeoutReference\n}) {\n    const timer = useTimer({\n        startAt: singleTimeout.timeoutStart,\n        duration: singleTimeout.timeoutDuration / 1000,\n        nowCallback: nowCallback\n    });\n    const isG301 = isG301Timeout(singleTimeout);\n    return <>\n        <div className={`timeout alert text-center ${isG301 ? \"alert-danger\" : \"alert-warning\"}`}\n             onClick={(e) => bigTimer(singleTimeout)}> {/*idk why this type flags without the as - type guard a few lines up should cover it*/}\n            {/*<div hidden={isG301Timeout(singleTimeout)}>{`Timeout${singleTimeout.series > 0 ? ` (SF${singleTimeout.series})` : \"\"}: ${renderTime(timer.remaining)}`}</div>*/}\n            <div hidden={!isG301}>{`2 Minute Warning Active: ${renderTime(timer.remaining)}`}</div>\n            <div className={\"text-sm font-italic\"}>{t`Tap for fullscreen timer`}</div>\n        </div>\n        <BigTimer nowCallback={nowCallback} timeout={selectedTimer} show={fullscreen} exitFullscreen={clear} isConnected={isConnected}/>\n    </>\n}\n\n/**\n * Renders a smaller timeout timer in the corner for use when displaying 2 is possible\n */\nfunction CornerTimeout({timeout, nowCallback, setBigTimer} : {\n    nowCallback: () => number,\n    setBigTimer: (to: any) => void,\n    timeout? : any\n}) {\n    const EMPTY = <div className={\"col-4\"}/>;\n    const timer = useTimer({\n        startAt: timeout?.timeoutStart,\n        duration: timeout ? (timeout.timeoutDuration / 1000) : 0,\n        nowCallback: nowCallback\n    });\n    if (!timeout || timeout.timeoutStart === 0) {\n        return EMPTY;\n    }\n    return <div className={`col-4 text-center ${timeout.isElims && timer.remaining <= 240 ? \"alert-danger\": \"alert-warning\"} cornerTimer`} onClick={e => setBigTimer(timeout)}>\n        <span>{`Timeout (SF${timeout.series})`}</span><br/><span>{renderTime(timer.remaining)}</span>\n    </div>\n}\n\n/**\n * FRC-Style referee timeout timer\n * Shows a single timeout timer as a large full-screen timer on black background.\n * Can be rotated via button so device can stay rotation-lock if bigger is desired.\n */\nfunction BigTimer({nowCallback, show, exitFullscreen, timeout, isConnected} : {\n    nowCallback: () => number,\n    show: boolean,\n    exitFullscreen: () => void,\n    timeout? : TimeoutReference,\n    isConnected: boolean\n}) {\n    const [rotate, setRotate] = useState<boolean>(false);\n    const timer = useTimer({\n        startAt: timeout?.timeoutStart || null,\n        duration: timeout ? (timeout.timeoutDuration / 1000) : 0,\n        nowCallback: nowCallback\n    });\n    const bigTimerLabel = timeout?.description;\n    return <div id=\"bigTimer\" hidden={!show} className={`text-center ${rotate ? \"rotate\" : \"\"}`}>\n        <div className={\"bigTimerContent\"}>\n            <div className={\"toastGap\"}/>\n            <div className={\"label\"}>{bigTimerLabel}</div>\n            <div className={\"time\"}>{timer ? renderTime(timer.remaining) : \"\"}</div>\n            <div className={\"ops d-flex justify-content-center\"}>\n                <button className={\"btn btn-outline-light mr-auto\"} onClick={exitFullscreen}>{t`Exit Fullscreen`}</button>\n                <div className={\"dc\"} hidden={isConnected}><i className={\"fa fa-exclamation-triangle\"}></i>{t`Disconnected!`}<i className={\"fa fa-exclamation-triangle\"}></i></div>\n                <button className={\"rotateBtn btn btn-outline-light ml-auto\"} onClick={() => setRotate(!rotate)}><i className={`fa fa-rotate-${rotate ? \"left\" : \"right\"}`}></i></button>\n            </div>\n        </div>\n    </div>\n}\n\n","import './Ref.css'\nimport {useEffect, useReducer, useRef, useState} from \"react\";\nimport {useInterval} from \"ftc-common/hooks\";\nimport {usePersistentWebsocketWithTime} from \"ftc-common/utils\"\nimport MatchScoring from \"./MatchScoring\";\nimport {\n    Loaded,\n    Match,\n    MatchState,\n    RefMessage,\n    RefUpdate,\n    RefUpdateType,\n    Response,\n    Scores, TimeoutUpdate\n} from \"../javaTypes\";\nimport {\n    AllianceColor\n} from \"ftc-common/javaTypes\";\nimport {t} from 'ftc-common/i18n';\nimport Timeout from \"./Timeout\";\n\nexport interface Alliance<T extends Scores> {\n    team1 : number,\n    team2 : number,\n    team3 : number,\n    team1Display : string,\n    team2Display : string,\n    team3Display : string,\n    team1Surrogate : boolean,\n    team2Surrogate : boolean,\n    scores : T,\n    initSubmitted : boolean,\n    autoSubmitted : boolean,\n    teleopSubmitted : boolean,\n    reviewSubmitted : boolean\n}\n\nexport interface RefMatch<T extends Scores> extends Match {\n    red : Alliance<T>,\n    blue : Alliance<T>,\n    lockout?: boolean,\n    state: MatchState,\n    // For state invalidation\n    abortedAt?: Date\n}\n\nexport enum MatchPhase {\n    SELECT,\n    LOCKOUT,\n    SETUP,\n    WAIT,\n    AUTO,\n    TELEOP,\n    REVIEW,\n    UNKNOWN\n}\n\ninterface SetListUpdate {\n    type: 'SET_MATCH_LIST',\n    matches: RefMatch<any>[]\n}\n\ninterface RandomizeUpdate {\n    type: RefUpdateType.RANDOMIZE,\n    match: number,\n    random: number\n}\n\ninterface MatchUpdate {\n    type: RefUpdateType.ABORT | RefUpdateType.LOCKOUT,\n    match: number\n}\n\ninterface MatchStartUpdate {\n    type: RefUpdateType.START,\n    match: number,\n    startTime: number\n}\n\ninterface ScoreUpdate {\n    type: RefUpdateType.SCORE_UPDATE,\n    match: number,\n    data: RefMatch<any>\n}\n\ninterface AllianceUpdate {\n    type:  RefUpdateType.SUBMIT_INIT | RefUpdateType.UNSUBMIT_INIT | RefUpdateType.SUBMIT_AUTO | RefUpdateType.SUBMIT_TELEOP | RefUpdateType.SUBMIT_MATCH,\n    match: number,\n    alliance : AllianceColor\n}\n\ntype MatchListUpdate = SetListUpdate | RandomizeUpdate | MatchUpdate | AllianceUpdate | ScoreUpdate | MatchStartUpdate\n\ninterface RefUpdateResponse extends Response {\n    payload: RefUpdateResponsePayload\n}\n\nexport interface RefUpdateResponsePayload {\n    status: 'SUCCESS' | 'ERROR',\n    message?: string\n}\n\nexport function allianceToKey(alliance : AllianceColor) : 'red' | 'blue' {\n    return alliance === AllianceColor.RED ? 'red' : 'blue'\n}\n\nfunction MatchSelect({alliance, matchList, setActiveMatchNum} : {\n    alliance: AllianceColor,\n    matchList: RefMatch<any>[],\n    setActiveMatchNum: (num: number) => void\n}) {\n    const filteredMatches = matchList.filter(m => !m[allianceToKey(alliance)].reviewSubmitted && !m.lockout);\n    if(filteredMatches.length === 0) {\n        return <div className=\"form-group row justify-content-center\">\n            <div>No active matches at this time.</div>\n        </div>\n    }\n    return <>\n        {filteredMatches.map(m => {\n            return <div className=\"form-group row justify-content-center\" key={m.number}>\n                <button onClick={() => setActiveMatchNum(m.number)} className={`btn btn-outline-primary btn-lg col-10 mt-2 selectActiveMatch${m.number}Button d-flex flex-wrap justify-content-center pl-1 pr-1`}>\n                    <span className=\"mx-2 inline-block\">Match {m.shortName}</span>\n                    <span className=\"mx-2 inline-block redTeams\">Red Teams: {m.red.team1Display}, {m.red.team2Display}{m.red.team3 > 0 ? `, ${m.red.team3Display}` : ''}</span>\n                    <span className=\"mx-2 inline-block blueTeams\">Blue Teams: {m.blue.team1Display}, {m.blue.team2Display}{m.blue.team3 > 0 ? `, ${m.blue.team3Display}` : ''}</span>\n                </button>\n            </div>\n        })}\n    </>\n}\n\nfunction matchReducer(oldList : RefMatch<any>[], update : MatchListUpdate) {\n    function updateAlliance(allianceUpdate : Partial<Alliance<any>>) {\n        const aUpdate = update as AllianceUpdate\n        return oldList.map(m => {\n            if (m.number !== aUpdate.match) {\n                return m;\n            }\n            return Object.assign<{}, RefMatch<any>, Partial<RefMatch<any>>>({}, m, {\n                [allianceToKey(aUpdate.alliance)]: Object.assign<{}, Alliance<any>, Partial<Alliance<any>>>({}, m[allianceToKey(aUpdate.alliance)], allianceUpdate),\n            })\n        })\n    }\n\n    switch (update.type) {\n        case 'SET_MATCH_LIST':\n            return update.matches;\n        case RefUpdateType.RANDOMIZE:\n            return oldList.map(m => {\n                    if(m.number !== update.match) {\n                        return m;\n                    }\n                    return Object.assign<{}, RefMatch<any>, Partial<RefMatch<any>>>({}, m, { state: MatchState.RANDOMIZED, randomization: update.random })\n                })\n        case RefUpdateType.START:\n            return oldList.map(m => {\n                if(m.number !== update.match) {\n                    return m;\n                }\n                return Object.assign<{}, RefMatch<any>, Partial<RefMatch<any>>>({}, m, { state: MatchState.AUTO, start: update.startTime })\n            })\n        case RefUpdateType.ABORT:\n            return oldList.map(m => {\n                if(m.number !== update.match) {\n                    return m;\n                }\n                // abortedAt is purely for state purging\n                return Object.assign<{}, RefMatch<any>, Partial<RefMatch<any>>>({}, m, { state: MatchState.RANDOMIZED,\n                    abortedAt: new Date(),\n                    red: Object.assign<{}, Alliance<any>, Partial<Alliance<any>>>({}, m.red, { initSubmitted: false }),\n                    blue: Object.assign<{}, Alliance<any>, Partial<Alliance<any>>>({}, m.blue, { initSubmitted: false })\n                })\n            })\n        case RefUpdateType.LOCKOUT:\n            return oldList.map(m => {\n                if(m.number !== update.match) {\n                    return m;\n                }\n                return Object.assign<{}, RefMatch<any>, Partial<RefMatch<any>>>({}, m, { lockout: true })\n            })\n        case RefUpdateType.SCORE_UPDATE:\n            return oldList.map(m => {\n                if(m.number !== update.match) {\n                    return m;\n                }\n                update.data.red.scores = JSON.parse(update.data.red.scores);\n                update.data.blue.scores = JSON.parse(update.data.blue.scores);\n                return update.data\n            })\n        case RefUpdateType.SUBMIT_INIT:\n            return updateAlliance({ initSubmitted: true });\n        case RefUpdateType.UNSUBMIT_INIT:\n            return updateAlliance({ initSubmitted: false });\n        case RefUpdateType.SUBMIT_AUTO:\n            return updateAlliance({ autoSubmitted: true });\n        case RefUpdateType.SUBMIT_TELEOP:\n            return updateAlliance({ teleopSubmitted: true });\n        case RefUpdateType.SUBMIT_MATCH:\n            return updateAlliance({ reviewSubmitted: true });\n        default:\n            console.error(\"Unknown update: \" + JSON.stringify(update));\n            return oldList;\n    }\n}\nconst initialNum = window.location.hash.replace(\"#match-\", \"\");\n\nexport default function Ref({event, alliance, field, fieldCount} : {\n    event : string,\n    alliance : AllianceColor,\n    field : number,\n    fieldCount: number\n}) {\n    const { isConnected, now: nowCallback, send } = usePersistentWebsocketWithTime(\n        `/stream/ref/?code=${event}&alliance=${alliance}&field=${field}`,\n        handleMessage);\n    //TODO persist to storage/url in some form\n    const [matchList, dispatchMatchList] = useReducer(matchReducer, []);\n    const [activeMatchNum, setActiveMatchNum] = useState(initialNum ? parseInt(initialNum) : null);\n    const [lagging, setLagging] = useState<boolean>(false);\n    const pendingMessages = useRef<Record<number, [(res : RefUpdateResponsePayload) => void, number]> & { id: number }>({ id: 0});\n    const [timeouts, setTimeouts] = useState<TimeoutUpdate | undefined>();\n\n    useEffect(() => {\n        function onHashChange() {\n            let n = parseInt(window.location.hash.replace(\"#match-\", \"\"));\n            setActiveMatchNum(isNaN(n) ? null : n);\n        }\n        window.addEventListener(\"hashchange\", onHashChange)\n        return () => {\n            window.removeEventListener(\"hashchange\", onHashChange)\n        }\n    }, [])\n    function openActiveMatchNum(num : number | null) {\n        if(num) {\n            window.location.hash = `match-${num}`;\n        } else {\n            window.location.hash = '';\n        }\n        setActiveMatchNum(num);\n    }\n\n    const activeMatch = matchList.find(m => m.number === activeMatchNum);\n    useEffect(() => {\n        const activeMatch = matchList.find(m => m.number === activeMatchNum);\n        if(activeMatch && activeMatch[allianceToKey(alliance)].reviewSubmitted) {\n            openActiveMatchNum(null);\n        }\n    }, [activeMatchNum, matchList, alliance])\n\n    function handleMessage(msg : RefUpdate) {\n        if (msg.type === RefUpdateType.RESPONSE) {\n            const res = msg as RefUpdateResponse\n            const promiseData = pendingMessages.current[res.id];\n            if(promiseData) {\n                clearTimeout(promiseData[1])\n                promiseData[0](res.payload)\n            } else {\n                console.warn(\"Received unknown response: \" + JSON.stringify(msg))\n            }\n        } else if (msg.type === RefUpdateType.LOADED) {\n            dispatchMatchList({\n                type: 'SET_MATCH_LIST', matches: (msg as Loaded).loadedMatches.filter(m => m.field === 0 || field === 0 || m.field === field).map(m => {\n                    m.red.scores = JSON.parse(m.red.scores);\n                    m.blue.scores = JSON.parse(m.blue.scores);\n                    return m;\n                })\n            })\n        } else if (msg.type === RefUpdateType.TIMEOUT) {\n            setTimeouts(msg as TimeoutUpdate);\n        } else {\n            dispatchMatchList(msg as MatchListUpdate);\n        }\n    }\n\n    function sendMessage(msg : Omit<RefMessage, \"id\">) : Promise<RefUpdateResponsePayload> {\n        const id = pendingMessages.current.id++;\n        const ret = new Promise<RefUpdateResponsePayload>((resolve, reject) => {\n            pendingMessages.current[id] = [resolve, window.setTimeout(() => {\n                delete pendingMessages.current[id]\n                reject(\"timeout\")\n            }, 1000)]\n        });\n        send(JSON.stringify(Object.assign({}, msg, { id: id })))\n        return ret\n    }\n    useInterval(() => setLagging(!!activeMatch && activeMatch.start > 0 && (\n        // Auto lagging at start of teleop\n        (activeMatch.start + 38000 < nowCallback() && !activeMatch[allianceToKey(alliance)].autoSubmitted)\n            // dc lagging 10s after buzzer\n        || (activeMatch.start + 168000 < nowCallback() && !activeMatch[allianceToKey(alliance)].teleopSubmitted)\n    )), 500);\n\n    let phase : [MatchPhase, string] = [MatchPhase.SELECT, t`Match Selection`];\n    if(activeMatch) {\n        if(activeMatch.lockout) {\n            phase = [MatchPhase.LOCKOUT, t`Live Score Lockout`];\n        } else if(!activeMatch[allianceToKey(alliance)].initSubmitted) {\n            phase = [MatchPhase.SETUP, t`${activeMatch.shortName} Pre-Match Setup`];\n        } else if(activeMatch.state === 'RANDOMIZED' || activeMatch.state === 'UNPLAYED') {\n            phase = [MatchPhase.WAIT, t`Wait For Match Start`];\n        } else if(!activeMatch[allianceToKey(alliance)].autoSubmitted) {\n            phase = [MatchPhase.AUTO, t`${activeMatch.shortName} AUTO`];\n        } else if(!activeMatch[allianceToKey(alliance)].teleopSubmitted) {\n            phase = [MatchPhase.TELEOP, t`${activeMatch.shortName} TELEOP`];\n        } else if(!activeMatch[allianceToKey(alliance)].reviewSubmitted) {\n            phase = [MatchPhase.REVIEW, t`${activeMatch.shortName} Review`];\n        } else {\n            phase = [MatchPhase.UNKNOWN, t`${activeMatch.shortName} unknown state`];\n        }\n    }\n\n    const shortName = activeMatch?.shortName\n    return <div className={lagging ? \"laggingBlink\" : \"\"}>\n        <Timeout timeoutUpdate={timeouts} match={activeMatch} phase={phase[0]} field={field} fieldCount={fieldCount} nowCallback={nowCallback} isConnected={isConnected}/>\n        <div className=\"row justify-content-center\">\n            <div className={`col-10 alert h4 alliance ${alliance.toLowerCase()} text-center`}>\n                {phase[1]} {fieldCount > 1 ? `(${field == 0 ? t`All Fields` : t`Field ${field}`})` : ''}\n            </div>\n        </div>\n        {isConnected ? null : <div className=\"dcAlert\">\n            <div className=\"dcInner\">\n                DISCONNECTED!\n            </div>\n        </div>}\n        {phase[0] === MatchPhase.LOCKOUT ? <>\n            <div className=\"form-group row justify-content-center\">\n                <div className=\"text-center\">\n                    {t`The Scorekeeper has locked out editing the scores for match ${shortName}.`}<br/><br/>\n                    {t`If you needed to make additional changes, please contact the Scorekeeper ASAP.`}\n                </div>\n            </div>\n            <br/>\n            <br/>\n            <div className=\"form-group row justify-content-center\">\n                <button onClick={() => openActiveMatchNum(null)} className=\"btn btn-info\" role=\"button\">{t`Return to match select`}</button>\n            </div>\n        </> : (activeMatch ?\n            <MatchScoring alliance={alliance} match={activeMatch} phase={phase[0]} sendMessage={sendMessage}/> :\n            <MatchSelect matchList={matchList} alliance={alliance} setActiveMatchNum={openActiveMatchNum} />)}\n\n    </div>\n}\n","import Ref from \"./Ref\";\nimport {AllianceColor} from \"ftc-common/javaTypes\";\nimport LocalErrorBoundary from \"../LocalErrorBoundary\";\nimport { createRoot } from \"react-dom/client\";\n\ndeclare global {\n    interface Window {\n        eventCode: string,\n        alliance: AllianceColor,\n        field: number,\n        fieldCount: number\n    }\n}\n\nconst container = document.getElementById('reactContainer');\nif(!container) {\n    console.error(\"Mount point for container not found\")\n} else {\n    const root = createRoot(container);\n    root.render(<LocalErrorBoundary>\n        <Ref event={window.eventCode} alliance={window.alliance} field={window.field} fieldCount={window.fieldCount}/>\n    </LocalErrorBoundary>);\n}"],"names":["Toggle","label","half","wide","value","setValue","disabled","options","color","id","useUniqueId","jsxs","Fragment","jsx","ToggleButtonGroup","o","idx","ToggleButton","BubbleType","BubbleType2","getBubbleContent","type","t","getBubbleData","content","toTrue","currentBubble","TrainingBubble","setCurrentBubble","match","data","useEffect","elem","isTop","style","hasNext","bubbleContent","getNoShowString","score","teamPos","isElims","classifierPositions","colorCapsNames","AllianceColor","replaceClassifierState","state","position","existing","newState","invalidArtifactIndexes","artifacts","indexes","foundNone","artifact","index","ArtifactType","allianceColors","robotArr","autoFields","teleopFields","penaltyFields","Classifier","setScoreValue","field","invalidIndexes","idPrefix","useId","gateSvg","useAsset","ReactSVG","pos","e","Artifact","Init","scores","setupScores","robots","alliance","isReview","allianceToKey","noshowToToggleValue","v","toggleValueToNoshow","teamString","team","val","noShowVal","Auto","myFields","c","Counter","num","Penalties","Teleop","validationErrors","phase","errors","fields","MatchPhase","currentScores","isPlayoff","hasNoRobot","ShowRandomization","randomization","randomizationArtifacts","MatchScoring","sendMessage","currentRedScores","setRedScores","currentRedScoresRef","useStateRef","currentBlueScores","setBlueScores","currentBlueScoresRef","prevMatchRef","useRef","errorMessage","setErrorMessage","useState","_a","sendScores","newScores","redScores","blueScores","filterRedFields","filterBlueFields","target","partialRedScores","key","partialBlueScores","res","RefMessageType","was","calculateRobots","ns1","ns2","ns3","tempRobots","allTeams","team1","team2","redRobots","blueRobots","preloadTarget","submitPhaseAndScroll","scoreProps","invalidMessages","errorDisplay","initAlliance","initDisplayColor","ns","MatchType","Timeout","timeoutUpdate","fieldCount","nowCallback","isConnected","fullscreen","setFullscreen","selectedTimer","setSelectedTimer","clear","useCallback","fullscreenChange","isFullScreen","x","isEqual","disableFullscreen","bigTimer","timeout","g301Timeout","isG301Timeout","SingleTimeout","singleTimeout","timer","useTimer","isG301","renderTime","BigTimer","show","exitFullscreen","rotate","setRotate","bigTimerLabel","MatchPhase2","MatchSelect","matchList","setActiveMatchNum","filteredMatches","m","matchReducer","oldList","update","updateAlliance","allianceUpdate","aUpdate","RefUpdateType","MatchState","initialNum","Ref","event","send","usePersistentWebsocketWithTime","handleMessage","dispatchMatchList","useReducer","activeMatchNum","lagging","setLagging","pendingMessages","timeouts","setTimeouts","onHashChange","n","openActiveMatchNum","activeMatch","msg","promiseData","ret","resolve","reject","useInterval","shortName","container","createRoot","LocalErrorBoundary"],"mappings":"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"}